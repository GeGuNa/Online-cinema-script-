define("violators","init",function(e){var a=function(e){return'<div class="static-bl js-violators_item_revert">'+e.text+'<a href="#" data-action="'+e.action+'" data-revert="1" class="js-action_link">'+L("Отменить")+"</a></div>"},s=function(){return'<div class="hide js-violators_item_inner">'};define("violators","onRequest",function(e){$("#main").action("retain_dating delete_dating_block dating_block retain_dating_block",function(e){e.preventDefault();var o=$(this),n=o.parents(".js-violators_item"),i=n.data("user_id"),r="retain_dating"==e.linkAction||"delete_dating_block"==e.linkAction;o.prepend('<span class="ico f__ico_spinner2 js-spinner">'),Spaces.api(r?"dating.applyAnketa":"dating.denyAnketa",{User:i,CK:null},function(e){if(0==e.code){if(o.data("revert")||$(".js-violators_item.js-deleted").remove(),o.data("revert")){var i=n.find(".js-violators_item_inner"),t=n.find(".js-violators_item_revert");n.append(i.children()),i.remove(),t.remove(),n.removeClass("js-deleted")}else n.children().wrapAll(s()),n.append(a({text:r?L("Пользователь добавлен в знакомства."):L("Пользователь удалён из знакомств."),action:r?"dating_block":"retain_dating"})),n.addClass("js-deleted"),tick(function(){var e=$(window).scrollTop(),i=o.offset().top-e;$("html, body").scrollTop(n.offset().top-i)});n.find(".js-spinner").remove()}else Spaces.showApiError(e)},{onError:function(e){Spaces.showError(e)}})}),$("#main").action("violator_skip violator_unskip",function(o){o.preventDefault();var n=$(this),r=n.parents(".js-violators_item"),e=r.data("user_id");n.prepend('<span class="ico f__ico_spinner2 js-spinner">'),Spaces.api("violator_skip"==o.linkAction?"violators.skip":"violators.unskip",{User:e,CK:null},function(e){if(0==e.code){if(n.data("revert")||$(".js-violators_item.js-deleted").remove(),n.data("revert")){var i=r.find(".js-violators_item_inner"),t=r.find(".js-violators_item_revert");r.append(i.children()),i.remove(),t.remove(),r.removeClass("js-deleted")}else r.children().wrapAll(s()),r.append(a({text:"violator_skip"==o.linkAction?L("Нарушитель скрыт. "):L("Нарушитель вернут в список. "),action:"violator_skip"==o.linkAction?"violator_unskip":"violator_skip"})),r.addClass("js-deleted"),tick(function(){var e=$(window).scrollTop(),i=n.offset().top-e;$("html, body").scrollTop(r.offset().top-i)});r.find(".js-spinner").remove()}else Spaces.showApiError(e)},{onError:function(e){Spaces.showError(e)}})}).action("remarks_load",function(e){var i,t,o,n,r,a;e.preventDefault(),t=(i=$(this)).parents(".js-violators_item").data("user_id"),o=$("#remarks_"+t),n=o.data(),r=o.children().length,n.limit||(n.limit=r),i.data("busy")||((a=function(e){i.find(".js-ico").toggleClass("ico_spinner",e),i.data("busy",e)})(!0),Spaces.api("neoapi/remarks.getList",{User:t,O:r,L:n.limit,Link_id:Spaces.params.link_id},function(e){a(!1),0!=e.code?Spaces.showApiError(e):(o.append(e.remarks.join("")),e.remarks.length<n.limit&&i.remove())},{onError:function(e){a(!1),Spaces.showError(e)}}))})})});