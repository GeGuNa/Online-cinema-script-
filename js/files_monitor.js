define("files_monitor","init",function(){function v(t){var e=t.prop("tagName");return e&&/^textarea|input$/i.test(e)}function t(){var r,i,p,l=!1;d&&(i=$("#main"),$("body").on("dragover.oneRequest",function(t){var e,a,n=t.originalEvent;if(o(n.dataTransfer.types)){for(t.preventDefault(),e=0;e<f.length;++e)(a=f[e]).addClass(a.data("dragavail-class"));l||i.trigger("dragGlobalStart"),l=!0,r&&(clearTimeout(r),r=null)}}).on("dragleave.oneRequest drop.oneRequest",function(t){var e=t.originalEvent;o(e.dataTransfer.types)&&("drop"==t.type&&e.preventDefault(),!1,r||(r=setTimeout(function(){var t,e;for(t=0;t<f.length;++t)(e=f[t]).removeClass(e.data("dragavail-class"));r=null,l&&i.trigger("dragGlobalEnd"),l=!1},u)))}),g&&document.addEventListener&&(p=function(t){0<t.length&&y.el.trigger("pasteurl",{urls:t,target:y.el,fromInput:v(y.el)})},document.addEventListener("paste",function(e){var a,n,r,i,l,s,o,f,d,g,u,c=e.clipboardData;y&&((a=m(c))?(e.preventDefault(),y.el.focus(),y.el.trigger("ffpastefiles",{files:a}),y=null):0<=$.inArray("text/plain",c.types)?(e.preventDefault(),r=h(n=c.getData("text/plain")),p(r),v(y.el)&&(y.el.focus(),f=n,d=(o=y).el.val(),g=d.substring(0,o.start),u=d.substring(o.end,d.length),o.el.val(g+f+u),set_caret_pos(o.el[0],o.start+f.length,o.start+f.length)),y=null):0<=$.inArray("text/html",c.types)?(e.preventDefault(),(i=c.getData("text/html"))&&(l=i.match(/<img[^>]+src="(http(s?):([^"]+))"/im))&&(r=h(l[1]),p(r)),y=null):(s=y.el,y=null,x.focus(),function t(e,a,n){var r=e.find("img");if(e.length&&0<n){if(!r.length)return void setTimeout(function(){t(e,a,--n)},20);a&&a(r.attr("src"))}e.empty()}(x,function(t){if(s.focus(),0==t.indexOf("http"))p(h(t));else{var e=function(t){var e,a,n,r,i,l,s=";base64,";if(t&&"data:"==t.substr(t,5).toLowerCase()&&-1<t.indexOf(s)){for(a=(e=t.split(s))[0].split(":")[1],n=atob(e[1]),r=new Uint8Array(n.length),i=0,l=n.length;i<l;++i)r[i]=n.charCodeAt(i);return new Blob([r],{type:a})}return null}(t);e&&s.trigger("ffpastefiles",{files:[e]})}},20)))},!1)))}function h(t){var e,a,n,r=[],i=/^http(s?):\/\//i;for(l.lastIndex=0;t&&(e=l.exec(t));)n=e[(a=e[4]?0:e[11]?7:14)+2],i.test(n)||(n="http://"+n),r.push({url:n,domain:e[a+4]});return r}function m(t){var e,a,n,r;if(t){if(t.files&&0<t.files.length)return t.files;if("items"in t&&t.items){for(e=[],a=0;a<t.items.length;++a)"file"==(n=t.items[a]).kind&&n.getAsFile&&(r=n.getAsFile(),e.push(r));if(0<e.length)return e}}if((t=window.clipboardData)&&t.files&&0<t.files.length)return t.files}function o(t){return(-1<$.inArray("Files",t)||-1<$.inArray("application/x-moz-file",t))&&$.inArray("text/_moz_htmlcontext",t)<0}var y,f=[],e=-1!=navigator.platform.indexOf("Mac"),d="ondragover"in document.body,g="firefox"==Device.browser&&window.atob,i=".spdnd"+Date.now(),u=300,a=["xn--p1ai|xn--j1amh|xn--80asehdb|xn--80aswg","рф|укр|онлайн|сайт|срб|su"],n="([!()?.,\\s\\n\\r]|^)",r="(?:[.!:;,*()]*([\\s\\r\\n]|$))",l=RegExp("(?:"+n+"((https?://)?((?:[a-z0-9_\\-]+\\.)+(?:[a-z]{2,7}|"+a[0]+"))(/.*?)?(\\#.*?)?)"+r+"|"+n+"((https?://)?((?:[a-z0-9а-яєґї_\\-]+\\.)+(?:"+a[1]+"))(/.*?)?(\\#.*?)?)"+r+"|"+n+"((https?://)((?:[a-z0-9а-яєґї_\\-]+\\.)+(?:[a-z]{2,7}|"+a[1]+"))(/.*?)?(\\#.*?)?)"+r+")","gi"),x=$('<div contenteditable="true" style="position:fixed;width:1px;height:1px;opacity:0;overflow:hidden"></div>');Spaces.checkUrl=function(t){l.lastIndex=0;var e=l.exec(t);return!(!e||0!==$.trim(t).indexOf($.trim(e[0])))},Spaces.extractUrls=h,$.fn.filesMonitor=function(){var s,a,n,r,t=arguments;return 1<this.length?(this.each(function(){$.fn.draggable.apply($(this),t)}),this):(n=!1,(s=this).data("inited"+i)||(s.data("inited"+i,!0),f.push(s),d&&s.on("dragenter"+i,function(t){o(t.originalEvent.dataTransfer.types)&&t.preventDefault()}).on("dragover"+i,function(t){var e=t.originalEvent;a&&(clearTimeout(a),a=null),o(e.dataTransfer.types)&&(t.preventDefault(),n||s.trigger("fileDragStart"),n=!0,s.addClass(s.data("dragover-class")),s.removeClass(s.data("dragleave-class")))}).on("dragleave"+i,function(t){t.originalEvent;a||(a=setTimeout(function(){n&&s.trigger("fileDragEnd"),n=!1,s.removeClass(s.data("dragover-class")),s.addClass(s.data("dragleave-class"))},u))}).on("drop"+i,function(t){var e=t.originalEvent;0<e.dataTransfer.files.length&&!e[i]&&(t.preventDefault(),s.trigger("fileDragEnd"),s.trigger("dragGlobalEnd"),s.trigger("files",{files:e.dataTransfer.files}),n=!1,s.removeClass(s.data("dragover-class")),s.removeClass(s.data("dragleave-class")),e[i]=!0)}),g?(r=function(t){if(!y||1e3<=Date.now()-y.time){var e=t.target;y={el:$(e),start:e.selectionStart,end:e.selectionEnd,time:Date.now()},x.focus()}},s.on("keydown"+i,function(t){(e?t.metaKey:t.ctrlKey)&&86==t.keyCode&&r(t)}).on("ffpastefiles"+i,function(t,e){s.trigger("files",{files:e.files})}).on("paste"+i,function(t,e){$(t.target).data("no_paste")||r(t)})):s.on("paste"+i,function(t,e){var a,n,r,i,l=$(t.target);if(!l.data("no_paste"))if(a=t.originalEvent.clipboardData||window.clipboardData,n=m(a))t.preventDefault(),tick(function(){s.trigger("files",{files:n})});else if(a&&(!a.types||0<=$.inArray("text/plain",a.types)||0<=$.inArray("Text",a.types))){try{r=a.getData("text/plain")}catch(t){}if(!r)try{r=a.getData("Text")}catch(t){}0<(i=h(r)).length&&s.trigger("pasteurl",{urls:i,target:l,fromInput:v(l)})}}),s.on("spacpaste"+i,function(t){var e,a=h($(this).val());0<a.length&&(e=$(t.target),s.trigger("pasteurl",{urls:a,target:e,fromInput:v(e)}))})),s)},define("files_monitor","onRequest",function(){t(),page_loader.on("shutdown","files_monitor",function(){d=[],f=[],y=null}),g&&$("#main").append(x)})});