define("form/date","init",function(){function l(t,e){var a=t.parents(".js-date_selector"),n=a.find(".js-date_year"),l=a.find(".js-date_month"),i=a.find(".js-date_day");return e&&(n.val(e.getFullYear()),l.val(e.getMonth()+1),i.val(e.getDate()),a.find(".js-date_label").text(e.getDate()+" "+d[e.getMonth()]+" "+e.getFullYear())),+n.val()||+l.val()||+i.val()?new Date(n.val(),l.val()-1,i.val(),0,0,0):new Date}function v(t){return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t}function i(t){var e,a=t.data("min")&&v(new Date(1e3*t.data("min"))),n=t.data("max")&&((e=new Date(1e3*t.data("max"))).setHours(23),e.setMinutes(59),e.setSeconds(59),e.setMilliseconds(0),e);t.data("mode")?t.html(x.monthList({date:t.data("date"),value:l(t),min:a,max:n})):t.html(x.datepicker({date:t.data("date"),value:l(t),min:a,max:n}))}var h=[L("Пн"),L("Вт"),L("Ср"),L("Чт"),L("Пт"),L("Сб"),L("Вс")],b=[6,0,1,2,3,4,5],f=[L("Январь"),L("Февраль"),L("Март"),L("Апрель"),L("Май"),L("Июнь"),L("Июль"),L("Август"),L("Сентябрь"),L("Октябрь"),L("Ноябрь"),L("Декабрь")],d=[L("января"),L("февраля"),L("марта"),L("апреля"),L("мая"),L("июня"),L("июля"),L("августа"),L("сентября"),L("октября"),L("ноября"),L("декабря")],x={cell:function(t,e,a){return'<div class="'+(e?" b":"")+(a?" blue":"")+'"><div class="fix"></div><div>'+t+"</div></div>"},pagination:function(t){var e=t.hasNext?"js-calendar_next":"s-city__pagination-btn_disabled",a=t.hasPrev?"js-calendar_next":"s-city__pagination-btn_disabled",n='<div class="s-city__pagination content-bl__top_sep"><table class="table__wrap"><tr><td class="table__cell s-city__pagination-btn s-city__pagination-btn_prev '+a+' relative" data-dir="-1"><span class="js-ico ico ico_arr3"></span> <span class="s-city__pagination-btn_label">'+t.prev+'</span></td><td class="table__cell s-city__pagination-btn js-calendar_toggle">'+t.current+'</td><td class="table__cell table__cell_last s-city__pagination-btn s-city__pagination-btn_next '+e+' relative" data-dir="1"><span class="s-city__pagination-btn_label">'+t.next+'</span> <span class="js-ico ico ico_arr"></td></tr></table></div>';return n},monthList:function(i){var t,e,d="";return d+='<div class="widgets-group dropdown-menu wbg"><table class="table__wrap t_center"><tr>',$.each(f,function(t,e){var a,n,l=v(new Date(i.date.getTime()));l.setMonth(t),l.setDate(1),a=i.value.getMonth()==l.getMonth()&&i.value.getFullYear()==l.getFullYear(),n=i.min&&i.min.getFullYear()>l.getFullYear()||i.min&&i.min.getFullYear()==l.getFullYear()&&i.min.getMonth()>l.getMonth()||i.max&&i.max.getFullYear()<l.getFullYear()||i.max&&i.max.getFullYear()==l.getFullYear()&&i.max.getMonth()<l.getMonth(),d+='<td class="js-calendar_select list-link list-link_last list-link-darkblue'+(n?" user__tools-link_disabled":"")+(a?" clicked":"")+'" '+(n?' data-disabled="1"':"")+'data-value="'+t+'">'+e+"</td>",t%2!=0&&(d+="</tr><tr>")}),d+="</tr></table>",t=i.date.getFullYear()+1,e=i.date.getFullYear()-1,d+=x.pagination({hasPrev:!i.min||i.min.getFullYear()<=e,prev:e,current:i.date.getFullYear(),hasNext:!i.max||i.max.getFullYear()>=t,next:t}),d+="</div>"},datepicker:function(t){var e,a,n,l,i,d,s,r,o,c,g,u,_,m="",p=v(new Date(t.date.getTime()));for(p.setDate(1),e=b[p.getDay()],m+='<div class="widgets-group dropdown-menu wbg">',m+='<div class="calendar-head"><table class="table__wrap calendar"><tr>',$.each(h,function(t,e){m+="<th>"+x.cell(e)+"</th>"}),m+="</tr></table></div>",m+='<table class="table__wrap calendar"><tr>',a=0;a<e;++a)m+="<td></td>";for(n=new Date;p.getMonth()==t.date.getMonth();)l=p.getDate(),!(e=b[p.getDay()])&&1<l&&(m+="</tr><tr>"),i=n.getMonth()==p.getMonth()&&n.getFullYear()==p.getFullYear()&&n.getDate()==p.getDate(),d=t.value.getMonth()==p.getMonth()&&t.value.getFullYear()==p.getFullYear()&&t.value.getDate()==p.getDate(),s=t.min&&p.getTime()<t.min.getTime()||t.max&&p.getTime()>t.max.getTime(),m+='<td class="list-link list-link_last js-calendar_select'+(d?" clicked":"")+(s?" user__tools-link_disabled":"")+'" '+(s?'data-disabled="1" ':"")+'data-value="'+l+'">'+x.cell(l,i,i&&!d&&!s)+"</td>",p.setDate(l+1);for(a=e;a<6;++a)m+="<td></td>";return m+="</tr></table>",r=t.date.getMonth()-1,o=t.date.getFullYear(),c=t.date.getMonth()+1,g=t.date.getFullYear(),r<0&&(r=11,--o),11<c&&(c=1,g++),u=t.min&&o<t.min.getFullYear()||t.min&&o==t.min.getFullYear()&&r<t.max.getMonth(),_=t.max&&g>t.max.getFullYear()||t.max&&g==t.max.getFullYear()&&c>t.max.getMonth(),m+=x.pagination({hasPrev:!u,prev:f[r],current:f[t.date.getMonth()]+" "+t.date.getFullYear(),hasNext:!_,next:f[c]}),m+="</div>"}};define("form/date","onRequest",function(){$(function(){$("#main").on("dd_menu_open",".js-date_picker",function(t){var n=$(this);n.data("date",l(n)),Spaces.view.setInputError(n,!1),n.on("click",".js-calendar_next",function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();var e=n.data("date"),a=+$(this).data("dir");n.data("mode")?e.setYear(e.getFullYear()+a):e.setMonth(e.getMonth()+a),i(n)}).on("click",".js-calendar_toggle",function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),n.data("mode",!n.data("mode")),i(n)}).on("click",".js-calendar_select",function(t){var e,a;t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),(e=$(this)).data("disabled")||(a=e.data("value"),n.data("mode")?(n.data("mode",!1).data("date").setMonth(a),i(n)):(n.data("date").setDate(a),l(n,n.data("date")),Spaces.DdMenu.close()))}),i(n)}).on("dd_menu_close",".js-date_picker",function(t){$(this).off().html("")})})})});