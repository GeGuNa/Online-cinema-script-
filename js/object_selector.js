define("object_selector","init",function(){var p,t,_=1,o=2,h=5,e=1,i=2,s=3,a=4,n=6,f=7,v=8,r=90,l=mkhash([[e,{method:"neoapi/services.searchSchool",cityParam:"C",result:"schools",notfound:L("Школа не найдена, попробуйте найти другую.")}],[i,{method:"neoapi/services.searchUniversity",cityParam:"C",result:"universities",notfound:L("ВУЗ не найден, попробуйте найти другой.")}],[f,{method:"neoapi/services.searchFaculty",cityParam:"C",result:"faculties",notfound:L("Факультет не найден, попробуйте найти другой.")}],[v,{method:"neoapi/services.searchFaculty",cityParam:"C",result:"chairs",notfound:L("Кафедра не найдена, попробуйте найти другую.")}],[a,{method:"neoapi/services.searchEmployer",cityParam:"C",result:"employers",notfound:L("Компания не найдена, попробуйте найти другую.")}],[s,{method:"neoapi/services.searchMilUnit",result:"mil_units",countryParam:"C",notfound:L("Военная часть не найдена, попробуйте найти другую.")}],[n,{method:"neoapi/services.searchSite",result:"sites",notfound:L("Сайт не найден, попробуйте найти другой.")}],[r,{method:"neoapi/devices.searchModel",result:"models",notfound:L("Телефон не найден, попробуйте найти другой.")}]]),m=function(t,e){var i;return e==r?(t.title||(t.title=t.brand+" "+t.name),i='<div class="js-objsel_item s-city__item s-city__item_mobile s-city__item_light s-chb '+(t.hidden?" hide ":"")+(t.selected?" clicked ":"")+'" data-id="'+t.id+'" data-title="'+t.title+'" ><div class="s-city__wrap-mobile-pic"><img src="'+ICONS_BASEURL+"devices/device_"+t.id+'_small.jpg" alt="" /> </div>'+t.title+"</div>"):i='<div class="js-objsel_item s-city__item  s-city__item_light s-chb '+(t.hidden?" hide ":"")+(t.selected?" clicked ":"")+'" data-id="'+t.id+'" data-title="'+t.title+'" >'+t.title+"</div>",i},g=function(t){return'<div class="s-city__stnd s-city__item_light content-bl__sep oh"><table class="table__wrap table__wrap-layout"><tr><td class="table__cell table__cell_large-ico"><span class="ico ico_compass ico_large left"></span></td><td><div class="oh">'+t+"</div></td></tr></table></div>"},b=function(t){var e=t.page<t.total?"js-objsel_pagenav_link":"s-city__pagination-btn_disabled",i=1<t.page?"js-objsel_pagenav_link":"s-city__pagination-btn_disabled",s='<div class="s-city__pagination js-objsel_pagenav"><table class="table__wrap"><tr><td class="table__cell s-city__pagination-btn s-city__pagination-btn_prev '+i+' relative" data-p="'+(t.page-1)+'"><span class="js-ico ico ico_arr3"></span> <span class="s-city__pagination-btn_label">'+L("Назад")+'</span></td><td class="table__cell s-city__pagination-btn js-objsel_pagenav_cnt">'+L("{0} из {1}",t.page,t.total)+'</td><td class="table__cell table__cell_last s-city__pagination-btn s-city__pagination-btn_next '+e+' relative" data-p="'+(t.page+1)+'"><span class="s-city__pagination-btn_label">'+L("Вперёд")+'</span> <span class="js-ico ico ico_arr"></td></tr></table></div>';return s},c=function(){return'<span class="ico ico_spinner"></span>'},y=function(t){return'<div class="s-city__stnd s-city__item_light t_center pad_t_a">'+t+"</div>"},j=function(t){return'<a href="#" class="list-link stnd-link_arr stnd-link_profile js-objsel_item" data-id="0" data-title="'+html_wrap(t.word)+'">'+L("Создать ")+"&laquo;<b>"+html_wrap(t.word)+'</b>&raquo; <span class="ico ico_arr"></span></a>'},d=Class({Constructor:function(t){var i,e,s=this;s.wrap=t,s.opts=t.data(),s.input=t.find(".js-objsel_input"),s.inputWrap=t.find(".js-usearch_parent"),s.result=t.find(".js-objsel_result"),s.offers=t.find(".js-objsel_offers"),s.current=t.find(".js-objsel_current"),s.empty=t.find(".js-objsel_item[data-empty]"),s.label=t.find(".js-objsel_label"),s.object_id=t.find(".js-hidden_value"),s.adapter=l[s.opts.type],s.wrap.on("click",".js-objsel_item",function(t){t.preventDefault(),t.stopPropagation();var e=$(this),i=e.data();i.title=e.attr("data-title"),s.select(i,!0)}).on("click",".js-objsel_pagenav_link",function(t){t.preventDefault(),t.stopPropagation(),$(this).parents(".js-objsel_pagenav").find(".js-objsel_pagenav_cnt").html(c()),s.search_offset=h*($(this).data("p")-1),s.usearch.refreshSearch()}).itemsSelector({selector:".js-objsel_item:visible",activeClass:"s-city__item_hovered",keydownArea:s.input,external:!0}),s.opts.render==_&&s.input.on("blur",function(){var e=Spaces.DdMenu.currentId();tick(function(){if(document.activeElement){var t=$(document.activeElement);if(t.parents("#search_selector__menu_"+s.opts.uniq).length||!t.parents("body").length)return;Spaces.DdMenu.close(e)}})}),i=s.input.val().length<1,s.usearch=t.find(".js-usearch_parent").usearch({length:1,allowEmpty:!0,enter:!0,skipDefault:!0,onInput:function(t){var e=t.value.length<1;i!=e&&(s.opts.render==o?(s.empty.toggle(e),s.offers.toggle(e),s.current.toggle(e),s.result.toggle(!e)):e&&(s.empty.show(),s.offers.show(),s.current.show(),s.result.hide()),e&&s.result.html(""),Spaces.DdMenu.fixSize(),i=e)},doSearch:function(t){s.stop_search?t.onSuccess():(t.refresh||(s.search_offset=0),s.search(t.query,t.onSuccess))}}),t.on("dd_menu_open",function(){s.stop_search=!1,s.original_value=s.input.val(),s.opts.render==_&&(s.skip_search=!0,s.inputWrap.addClass("search__results-show"));var a=s.getGeo();a&&s.offers.find("[data-city_id]").each(function(){var t=$(this),e=t.data("city_id"),i=t.data("country_id"),s=e&&e!=a.city||i&&i!=a.country;t.toggle(!s)})}).on("dd_menu_closed",function(){if(s.stop_search=!0,s.empty.show(),s.offers.show(),s.current.show(),s.result.hide().html(""),!1!==s.original_value){var t=$.trim(s.input.val());s.opts.create&&t.length?s.select({id:0,title:t}):s.input.val(s.original_value).trigger("input")}s.opts.render==_&&s.inputWrap.removeClass("search__results-show")}).on("clearSearchForm",function(){s.opts.render==_&&s.reset()}),s.last_input_value=$.trim(s.input.val()),(e=s.current.find(".js-objsel_item")).length&&e.data("id",s.object_id.val()),$("#search_selector__menu_"+s.opts.uniq).data("disabled",!1)},select:function(t,e){var i,s,a,n,r,l=this;l.stop_search=!0,l.empty.removeClass("clicked"),l.opts.render==o&&l.input.val("").trigger("input"),i=l.value(),t.empty?(l.object_id.val(0),l.opts.render==_&&l.input.val("").trigger("input"),l.empty.addClass("clicked"),l.current.find(".js-objsel_item").removeClass("clicked")):(l.object_id.val(t.id),l.current.html(m({id:t.id,title:html_wrap(t.title),selected:1})),l.opts.render==_&&l.input.val(t.title).trigger("input")),l.label.find(".js-btn_val").text(t.title),s=l.current.find(".js-objsel_item"),l.offers.children().each(function(){var t=$(this);t.toggle(t.data("id")!=s.data("id"))}),l.original_value=!1,e&&(Spaces.DdMenu.close(),l.input.blur()),l.last_input_value=$.trim(l.input.val()),a=l.isEmpty(),n=l.value(),r={selector:l,uniq:l.opts.uniq,id:n.id,text:n.text,raw:t,changed:n.id!=i.id||n.text!=i.text,empty:a},l.wrap.trigger("objectSelected",r),l.wrap.find(".js-toggle_attention").toggleClass("attention",a),l.wrap.find(".js-fill_error").toggleClass("hide",!a)},search:function(t,a){var e,i,s,n,r,l,o=this,c={O:o.search_offset,L:h,q:t},d=o.getGeo(),u=!1;if(o.adapter.countryParam&&(c[o.adapter.countryParam]=d.country,d.country||(e=L("Выберите сначала страну."))),o.adapter.cityParam&&(c[o.adapter.cityParam]=d.city,d.city||(e=L("Выберите сначала город."))),e||o.opts.type!=f&&o.opts.type!=v||(i=$("#form-item_universities").objectSelector())&&(s=i.value(),o.opts.create&&0<s.text.length||s.id?(c.U=s.id,c.U||(u=!0)):e=L("Выберите сначала университет.")),e||o.opts.type!=v||(n=$("#form-item_faculty").objectSelector())&&(s=n.value(),o.opts.create&&0<s.text.length||s.id?c.U||(c.F=s.id,c.F||(u=!0)):e=L("Выберите сначала факультет.")),r=function(){o.opts.render==_&&(o.empty.hide(),o.offers.hide(),o.current.hide(),o.result.show()),o.opts.create&&o.result.append(j({word:t}))},l=function(){o.result.html(g(o.adapter.notfound))},t.length<1)a();else{if(e)return o.result.html(y(e)),Spaces.DdMenu.fixSize(),r(),void a();if(u)return l(),r(),Spaces.DdMenu.fixSize(),void a();Spaces.cancelApi(p),p=Spaces.api(o.adapter.method,c,function(t){var e,i,s;if(a(),0==t.code){if(e=t[o.adapter.result],t.count||(t.count=e.length),t.count){for(i="",s=0;s<e.length;++s)i+=m(e[s],o.opts.type);o.result.html(i)}else l();r(),t.count>h&&o.result.append(b({page:o.search_offset/h+1,total:Math.ceil(t.count/h)}))}Spaces.DdMenu.fixSize()},{onError:function(){a()}})}},reset:function(){this.empty.click()},isEmpty:function(){return this.empty.hasClass("clicked")},uniq:function(){return this.opts.uniq},value:function(){return{id:+this.object_id.val()||0,text:this.last_input_value}},getGeo:function(){var t,e=this,i=e.wrap.parents(".js-parent");return i.length||(i=$("body")),(t=i.find(".js-geosel").geoSelector())&&t.value()}});$.fn.objectSelector=function(){var t=this.data();if(this.length)return t.objsel||(t.objsel=new d(this)),t.objsel},define("object_selector","onRequire",function(){t||(t=tick(function(){t=!1,$(function(){$(".js-objsel").each(function(){$(this).objectSelector()})})}))})});