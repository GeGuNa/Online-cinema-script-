define("slider","init",function(){function p(e){var t,r,i;return window.requestAnimationFrame?window.requestAnimationFrame(e):(t=Date.now(),i=setTimeout(e,r=16-Math.max(0,16-(t-o))),o=t+r,i)}var s,e,t,a,o=0,l=Class({MAX_OVERSCROLL:.2,SCROLL_MODE:{POSITIONAL:0,NATIVE_SCROLL:1},STATE:{START:0,MOVE:1,END:2},SELECT_SIZE:30,Static:{className:"Carousel"},Implements:[TSimpleEvents],Constructor:function(e){var t,r,i=this;i.operations={},i.el=e,i._animate_queue=[],i.markSelectionFix=!1,t=navigator.userAgent.match(/AppleWebKit\/([\d\.]+)/),i.dev={touch:"ontouchstart"in window||0<navigator.msMaxTouchPoints,transition:Device.css("transition"),transform:Device.css("transform","translatez(0)",/translate/i),webkit:t?t[1]:0,support3d:!1},i.dev.nativeScrollAccel=(534.3<i.dev.webkit||"ucbrowser"==Device.browser)&&"desktop"!=Device.type,i.dev.svg=document.implementation&&document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1"),i.dev.transition&&(r={webkitTransition:"webkitTransitionEnd",msTransition:"MSTransitionEnd",mozTransition:"mozTransitionEnd",oTransition:"oTransitionEnd otransitionend"},i.dev.transitionEnd=r[i.dev.transition]||"transitionend",i.dev.support3d=i.dev.transitionEnd&&i.dev.transform),i._last_state=this.STATE.START,i._pos=[],i.cur_scroll=0,i.scroll_mode="touch"==Device.type&&(i.dev.nativeScrollAccel||!i.dev.support3d)||"opera"==Device.browser&&Device.v<=12?i.SCROLL_MODE.NATIVE_SCROLL:i.SCROLL_MODE.POSITIONAL,i.check()},_setup:function(){var e,t,r,i,c,o,n,s,a,p=this;p.cb_on_resize||(p.cb_on_resize=function(){p.check()},$(window).on("resize",p.cb_on_resize),page_loader.push("shutdown",function(){p.cb_on_mousedown&&$(document).off("mousedown",p.cb_on_mousedown),$(window).off("resize",p.cb_on_resize)})),p.el.addClass("hide"),p.el.addClass("carousel"),p.el.toggleClass("carousel-bg",!!p.el.data("bg")||p.el.data("bg")===undefined),p.scroll_mode==p.SCROLL_MODE.NATIVE_SCROLL?p.el.addClass("carousel-native_scroll"):p.scroll_mode==p.SCROLL_MODE.POSITIONAL&&p.el.addClass("carousel-positional"),p.wrap=p.el.find(".carousel-wrap"),p.screen=p.el.find(".carousel-screen"),"opera"==Device.browser&&Device.v<=12&&p.wrap.css("margin-right","20px"),e=!1,p.el.hasClass("carousel-inited")||(p.screen.length||(r='<div class="carousel-wrap"></div>',0<(t=p.el.children()).length?t.wrapAll(r):p.el.append(r),p.wrap=p.el.find(".carousel-wrap"),p._setupHandlers(p.wrap),p.wrap.wrap('<div class="carousel-screen"></div>'),p.screen=p.el.find(".carousel-screen"),p.wrap.children().each(function(){$(this).wrap('<div class="carousel-item">')})),(i=p.screen.css("-webkit-mask-image")&&534.3<p.dev.webkit&&navigator.userAgent.indexOf("Puffin/")<0)&&p.screen.addClass("carousel-mask"),c=$('<div class="carousel-shadow"></div>'),p.el.append(c),p.prev=$('<div class="carousel-prev"><div class="ico ico_slider-prev"></div>'+(i?"":'<img src="'+ICONS_BASEURL+"carousel-shadow_prev."+(p.dev.svg?"svg":"png")+'" class="carousel-edges_shadow" />')+"</div>"),p.next=$('<div class="carousel-next"><div class="ico ico_slider-next"></div>'+(i?"":'<img src="'+ICONS_BASEURL+"carousel-shadow_next."+(p.dev.svg?"svg":"png")+'" class="carousel-edges_shadow" />')+"</div>"),p.screen.append(p.prev).append(p.next),p.prev.on("click",function(e){var t,r,i,o;e.preventDefault(),p.markSelectionFix&&(r=(t=e.originalEvent||e).touches?t.touches[0].clientX:e.pageX,i=t.touches?t.touches[0].clientY:e.pageY,!1!==(o=p._isMarkClick(r,i,-1)))?p.get(o).click():p.move(-.9*p.screen.innerWidth(),{fixEdges:!0,fixEdgesByDir:!0})}),p.next.on("click",function(e){var t,r,i,o;e.preventDefault(),p.markSelectionFix&&(r=(t=e.originalEvent||e).touches?t.touches[0].clientX:e.pageX,i=t.touches?t.touches[0].clientY:e.pageY,!1!==(o=p._isMarkClick(r,i,1)))?p.get(o).click():p.move(.9*p.screen.innerWidth(),{fixEdges:!0,fixEdgesByDir:!0})}),p.wrap.on("click",".carousel-item",function(e){if(p._slider_in_drag)return e.preventDefault(),e.stopPropagation(),void e.stopImmediatePropagation();p._trigger("selectSlide",[this])||(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation())}),p.scroll_mode!=p.SCROLL_MODE.POSITIONAL&&p.dev.nativeScrollAccel?p.scroll_mode==p.SCROLL_MODE.NATIVE_SCROLL&&(p.screen.on("touchstart",function(e){var t,r,i,o,n,s,a,l,c=e.originalEvent.touches,d=c?c[0].clientX:e.pageX;c?c[0].clientY:e.pageY;for(p.screen.removeProp("_sliderOnClick"),t=[p.prev,p.next],r=0;r<t.length;++r)o=(i=t[r]).find(".ico"),"none"!=i.css("display")&&(n=o.offset(),o.outerWidth(),s=n.left-parseInt(i.css("width").replace("px","")),a=n.left+parseInt(i.css("width").replace("px","")),0==r?s=p.screen.offset().left:a=p.screen.offset().left+p.screen.outerWidth(),s<=d&&d<=a&&p.screen.prop("_sliderOnClick",o));l=!1,p.screen.one("touchmove",function(e){l=!0}),Sidebar.lock(!0),p.screen.one("touchcancel touchend",function(){if(Sidebar.lock(!1),!l){var e=p.screen.prop("_sliderOnClick");if(e)return p.screen.removeProp("_sliderOnClick"),e.click(),!1}})}),p.wrap.scroll(function(e){p._in_jquery_animation||p._onresize(p.cur_scroll=p.wrap.scrollLeft())})):(p.scroll_mode==p.SCROLL_MODE.NATIVE_SCROLL&&p.wrap.css("overflow","hidden"),p.screen.on("dragstart",function(){return!1}),o=function(e){var o,n,s,a,l,t,r=e.originalEvent.touches;"mousedown"==e.type&&1!=e.which||r&&1<r.length||(p._in_animation&&(p._in_animation=!1),o=0,n=Date.now(),s=p.cur_scroll,a=function(e,t){var r=Date.now(),i=r-n;(t||100<=i)&&(200<i?o=0:(o=.8*(1e3*Math.abs(e-s)/(1+i))+.2*o,n=Date.now(),s=e))},l=function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault();var t=e.originalEvent||e,r=t.touches?t.touches[0].clientX:e.pageX;if(p.last_x-r!=0||p._slider_in_drag)return p.move(p.last_scroll+(p.last_x-r),{abs:!0,noAnimate:!0}),p.scroll_mode==p.SCROLL_MODE.POSITIONAL&&a(p.cur_scroll),p._slider_in_drag||(p._slider_in_drag=!0,c.show()),!1},t=function(e){var t,r,i;p.screen[0].removeEventListener&&p.screen[0].removeEventListener("touchmove",l),p.scroll_mode==p.SCROLL_MODE.POSITIONAL&&a(p.cur_scroll,!0),$(window).off(".spCarouselDrag"),$(document).off(".spCarouselDrag"),tick(function(){c.hide()}),p._slider_in_drag&&(p._slider_in_drag=!1,t=p.cur_scroll,r=p.last_scroll==t?0:p.last_scroll<t?1:-1,p.scroll_mode==p.SCROLL_MODE.POSITIONAL&&10<(i=o/1e3*400)?p.move(i*r,{fixEdges:!0,fixEdgesByDir:!0,delay:250,inertia:!0}):p._fixPosition(r))},$(document).on("mousemove.spCarouselDrag",l),p.screen[0].addEventListener?p.screen[0].addEventListener("touchmove",l,!1):p.screen.on("touchmove.spCarouselDrag",l),$(document).one("mouseup",t),p.screen.one("touchcancel touchend",t),p.last_x=r?r[0].clientX:e.pageX,p.last_scroll=p.cur_scroll,p.last_scroll_time=new Date)},"msie"==Device.browser&&Device.v<=8&&$(document).on("mousedown.spCarouselDrag",p.cb_on_mousedown=function(e){var t=p.screen.offset(),r=p.screen.outerWidth(),i=p.screen.outerHeight();if(t.left<=e.pageX&&t.left+r>=e.pageX&&t.top<=e.pageY&&t.top+i>=e.pageY)return o(e)}),p.screen.on("mousedown touchstart",o)),p.el.addClass("carousel-inited"),n=Date.now(),setTimeout(a=function(){var e=Date.now();p.el[0]&&("none"==p.el.css("display")?3e4<e-n?(++s,Loader.loadCSS(["Containers/Carousel"],!1,!0),n=Date.now(),setTimeout(a,100)):setTimeout(a,3<s?5e3:5e3<e-n?1200:500):(p.update(!0),p.check()))},s=0),e=!0),e&&p._trigger("sliderInit",[])},move:function(e,t){var r,i,o,n,s,a,l,c;if(t=t||{},!(r=this).overflow||!r._pos.length)return r;for(r._in_animation&&(r._in_animation=!1);;)if(i=r.cur_scroll,o=Math.floor(t.abs?e:i+e),n=r.max_width-r.screen.innerWidth(),s=0,t.abs&&r._slider_in_drag&&(n+=r.MAX_OVERSCROLL*r.screen.innerWidth(),s-=r.MAX_OVERSCROLL*r.screen.innerWidth()),n<o&&(o=n),o<s&&(o=s),t.fixEdges&&0<r._pos.length&&(a=t.direction||e,l=r._pos[0],c=r._pos[r._pos.length-1],l&&c&&((!t.fixEdgesByDir||a<0)&&l.x+.5*l.w>=o&&(o=0),(!t.fixEdgesByDir||0<a)&&n-c.w<=o&&(o=n))),r._onresize(o)){r._animate(o,!!t.noAnimate,t.time,!!t.inertia);break}return r},_fixPosition:function(e){return this.move(0,{fixEdges:!0,direction:e||0,fixEdgesByDir:!!e})},_isMarkClick:function(e,t){var r,i,o,n,s,a=this,l=a.wrap.offset();if(l&&(r=a.SELECT_SIZE/2,(i=a.padding.top+l.top-r)<=t&&t<=i+a.SELECT_SIZE))for(o=0;o<a._pos.length;++o)if(n=a._pos[o],(s=l.left+n.x+n.w-r)<=e&&e<=s+a.SELECT_SIZE)return o;return!1},_animate:function(r,e,i,t){var o,n,s,a,l,c,d;if(i=i||500,(o=this).scroll_mode==o.SCROLL_MODE.NATIVE_SCROLL){if(i=i||250,n=r-o.cur_scroll,o.cur_scroll=o.wrap.scrollLeft()+n,t)throw"Inertia not supported in native scroll!";o._in_jquery_animation&&o.wrap.stop(),e?o.cur_scroll=o.wrap.scrollLeft(r).scrollLeft():(o._in_jquery_animation=!0,window.requestAnimationFrame&&"desktop"==Device.type?(s=Date.now(),a=o.cur_scroll-n,l=function(){var e,t=Date.now()-s;i<=t?o.cur_scroll=o.wrap.scrollLeft(a+n).scrollLeft():(e=n*(t/i),o.wrap.scrollLeft(a+e).scrollLeft(),window.requestAnimationFrame(l))},window.requestAnimationFrame(l)):o.wrap.animate({scrollLeft:r},i,function(){o._in_jquery_animation=!1,o.cur_scroll=o.wrap.scrollLeft()}))}else if(o.scroll_mode==o.SCROLL_MODE.POSITIONAL){if(t)return i=200,s=Date.now(),n=r-o.cur_scroll,c=o.wrap.prop("style"),o._in_animation=!0,p(d=function(){if(o._in_animation){var e=Date.now()-s,t=-n*Math.exp(-e/i);4<t||t<-4?(o.cur_scroll=Math.floor(r+t),o.dev.support3d?(c[o.dev.transform]="translate3d("+-o.cur_scroll+"px, 0px, 0px)",c[o.dev.transition]=""):c.left=-o.cur_scroll+"px",p(d)):(o._in_animation=!1,o._fixPosition(0==n?0:n<0?-1:1))}}),o;o.dev.support3d?o.cur_scroll!=r&&(c=o.wrap[0].style,e||!o.wrap.is(":visible")?(c[o.dev.transform]="translate3d("+-r+"px, 0px, 0px)",c[o.dev.transition]=""):(c[o.dev.transform]="translate3d("+-r+"px, 0px, 0px)",c[o.dev.transition]=i/1e3+"s")):(c=o.wrap[0].style,e?(o.dev.transition&&(c[o.dev.transition]=""),c.left=-r+"px"):o.dev.transition?(c.left=-r+"px",c[o.dev.transition]=i/1e3+"s"):o.wrap.animate({left:-r+"px"},i)),o.cur_scroll=r}return o},_getMetricts:function(e){var t,r,i,o,n,s,a,l,c=this;if(!c.wrap[0].offsetWidth)return c._dirty_metrics=!0,c;if(null!==c._upd_start&&c._pos.length){for(o=c.total(),t=c.wrap.children(),n=c._pos[c._upd_start-1],c.max_width=n?n.locX+n.w:c.padding.left,c.max_inner_width=n?n.x+n.w:0,r=c._upd_start;r<o;++r)(s=c._pos[r])?(i=s.w,s.x=c.max_width-c.padding.left,s.locX=c.max_width):(a={w:i=$(t[r]).outerWidth(!0),x:c.max_width-c.padding.left,locX:c.max_width},s===undefined?c._pos.push(a):c._pos[r]=a),c.max_width+=i,c.max_inner_width+=i;c.max_width+=c.padding.right,c._pos.length>o&&(c._pos=c._pos.splice(0,o),o||(c._pos=[],c.max_width=c.max_inner_width=0)),c._upd_start=null}else{for(c.max_width=0,c.max_inner_width=0,c._pos=[],c.wrap.css({width:"auto"}),c.padding={left:parseInt(c.wrap.css("padding-left")),right:parseInt(c.wrap.css("padding-right")),top:parseInt(c.wrap.css("padding-top")),bottom:parseInt(c.wrap.css("padding-bottom"))},t=c.wrap.children(),c.max_width=c.padding.left,r=0;r<t.length;++r)i=$(t[r]).outerWidth(!0),c._pos.push({x:c.max_width-c.padding.left,locX:c.max_width,w:i}),c.max_width+=i,c.max_inner_width+=i;c.max_width+=c.padding.right,c._upd_start=null}return c.scroll_mode==c.SCROLL_MODE.POSITIONAL?(l=c.wrap[0].style,i=c.max_inner_width+2+"px",l.width!=i&&(l.width=i)):c.scroll_mode==c.SCROLL_MODE.NATIVE_SCROLL&&(c.cur_scroll=c.wrap.position().left),c},_getRect:function(e){return{x:(e=e||0)+this.padding.left,w:this.screen.innerWidth()-this.padding.left-this.padding.right}},isVisible:function(e){var t,r,i=this;if(0<=e&&e<i.total()&&i._pos.length){if(t=i._pos[e],i.screen.innerWidth(),r=i._getRect(i.cur_scroll),t.locX>=r.x&&t.locX+t.w<=r.x+r.w)return 0;if(t.locX<=r.x&&t.locX+t.w>=r.x)return-1;if(t.locX<=r.x+r.w&&t.locX+t.w>=r.x+r.w)return 1}return!1},_findItem:function(e){var t,r,i=this;for(t=0;t<i._pos.length;++t)if(r=i._pos[t],(0==t||r.x<=e)&&(t==i._pos.length-1||e<=r.x+r.w))return t;return-1},_onresize:function(e){var t,r,i,o,n=this;if(n.max_width&&!n._dirty_metrics||(n._dirty_metrics=!1,n._getMetricts()),"number"!=typeof e&&(e=n.cur_scroll),0<n._pos.length){if(n.overflow=n.max_width>n.screen.innerWidth(),t=n.overflow&&0<e,r=n.overflow&&e<n.max_width-n.screen.innerWidth(),n.prev.visible(t),n.next.visible(r),i=t?!r&&t?n.STATE.END:n.STATE.MOVE:n.STATE.START,n._last_state!=i&&(n._last_state=i)==n.STATE.END)return o=n.total(),n._trigger("sliderEnd",[]),o==n.total()||(n._onresize(e),!1)}else n.overflow&&(n.overflow=!1,n.prev.visible(!1),n.next.visible(!1));return!0},_setupHandlers:function(e){},replace:function(e,t){var r=this;if(!(e<0||e>=r.total()))return r._setupHandlers(t),$(r.wrap.children()[e]).empty().append(t),r._recalc(e),r.operations.replace=1,r},_recalc:function(e,t){var r=this;return null===r._upd_start&&(r._upd_start=r.total()),e<r._pos.length&&(r._pos[e]=null),r._upd_start=Math.min(r._upd_start,e),r},insertSpinners:function(e){var t,r=this,i="",o=r.total();for(t=0;t<e;++t)i+='<div class="carousel-item"><div'+(r._gallery_gid?' g="0|0|'+r._gallery_gid+'"':"")+' class="spinner preview'+(r._gallery_gid?" gview_link":"")+(r.size_class?r.size_class:" preview_spinner")+'" data-preloader="1"><span class="carousel-plc"></span><span class="carousel-plcd"><img src="'+ICONS_BASEURL+'preloader.gif" alt="" /></span></div></div>',r._recalc(o-1+e);return r.operations.insert=1,r.wrap.append(i),r},insert:function(e,t,r){var i,o,n=this,s=n._wrap(e),a=n.total();if(n._setupHandlers(e),o={after:"insertAfter",before:"insertBefore"},"after"==(t=t||"end")&&r==a-1&&(t="end"),"before"==t&&0==r&&(t="start"),(i={start:"prepend",end:"append"})[t])n.wrap[i[t]](s),"start"==t?n._recalc(0):"end"==t&&n._recalc(a-1),n.operations.insert=1;else if(o[t]){if(r<0||r>=n.total())return;n.operations.insert=1,s[o[t]](n.wrap.children()[r])}return n},removeAll:function(){for(;this.total();)this.pop();return this},remove:function(e){var t=this;if(!(e<0||e>=t.total()))return t.operations.remove=1,$(t.wrap.children()[e]).remove(),t._recalc(e),t},_wrap:function(e){var t=$('<div class="carousel-item">');return t.append(e),t},pop:function(){return this.remove(this.total()-1)},get:function(e,t,r){var i,o,n,s,a=this;if(e<0||e>=a.total())return null;if((t=t||1)<=1)return $(a.wrap.children()[e]);for(i=[],n=Math.min((o=e)+t,a.total());o<n;++o)s=$(a.wrap.children()[o]),i.push(r?s.children()[0]:s);return i},scroll:function(e,t,r){var i,o,n,s=this,a=s._pos[e];return s._slider_in_drag||!a?s:(o=0==(r=r||0),0<r?(n=s._getRect(s.cur_scroll),i=a.x+a.w-n.w):i=a.x,s.move(i,{fixEdges:o,abs:!0,noAnimate:!!t}))},scrollEnd:function(e){return this.scroll(this.total()-1,e)},scrollStart:function(e){return this.scroll(0,e)},update:function(e){var t=this,r=t.operations;return(e||r.remove||r.insert||r.replace)&&t._getMetricts(!0).check(),r.remove&&t._fixPosition(),t.operations={},t},isOverflowed:function(){return!!self.overflow},check:function(){var e=this;return e.wrap&&e.wrap.parent().length||e._setup(),e.scroll_mode==e.SCROLL_MODE.NATIVE_SCROLL&&(e.cur_scroll=e.wrap.scrollLeft()),e._onresize(),e},total:function(){return this.wrap.children().length}});window.Carousel=l,s=Class({Extends:l,Static:{FILES:0,DATING:1,className:"LoadableCarousel"},Constructor:function(e,t){var r=this;if(e=$(e),l.call(r,e),!t.adapter)throw"Adapter is not set!";r._adapter=new t.adapter(r,t.adapterOpts),r.size_class="",r.lc_opts=$.extend(!0,{total:0,select:!1,firstLoad:!0,gallery:!0,apiData:{},hasMore:!r.total(),limit:r.total()},r._adapter.params(),t),r.markSelectionFix=r.lc_opts.select,r.check(),r._setupLoader()},resetItems:function(e){return this.removeAll(),this._adapter.reset(),this.update(),this},_setupGallery:function(e){var r,i=this;return i._gallery_gid||(i._gallery_gid=e,r=null,i.lc_opts.gallery&&require("gallery",function(){GALLERY.onGroup(e,"partial",function(t){var r=function(){i._adapter.loadData(function(e){i._load_partial=!1,i._adapter.updatePartial(e),GALLERY.updatePartial(i._gallery_gid,i.get(0,t.partials.length,!0))},function(e){i._load_partial=!1,GALLERY.setGroupError(i._gallery_gid,e.message||L("Ошибка загрузки. "),r),i._trigger("loadError",[e])},0,t.types.length,{nids:t.nids,types:t.types})};i._load_partial||(i._load_partial=!0,r())}),GALLERY.onGroup(e,"load",function(e){i._go_next=e.dir,GALLERY.addPhoto(),GALLERY.update(!0)}),GALLERY.onGroup(e,"list",function(e){r=e.current,69<e.current/i.total()*100&&(i.loadNextPhotos(function(){GALLERY.setLoading(!1)}),GALLERY.addPhoto(),GALLERY.update(!0))}),i._adapter.avail()&&GALLERY.setGroupVisibleCount(e,i._adapter.total()),GALLERY.onGroup(e,"exit",function(e){if(i.update(!0),null!==r){var t=i.isVisible(r);0!==t&&i.scroll(r,!0,t)}r=null})})),i},_setupLoader:function(){var e,t,i=this;i._adapter.setup(),i.on("sliderEnd",function(){i.loadNextPhotos()}),i.lc_opts.select&&i.on("selectSlide",function(e){if((e=$(e)).data("preloader"))return!1;var t=(e=$(e)).children().first(),r=Spaces.core.extractFile(t);return i.toggleSelected(r.nid),i._trigger("selectFile",[t,r])}),i.lc_opts.gallery&&(e=i.get(0))&&(t=Spaces.File.getMeta(e.children().first()))&&i._setupGallery(t.gid),!i.total()&&i.lc_opts.firstLoad?i.firstLoad():i.lc_opts.gallery&&require("gallery",function(){GALLERY.addPhoto()})},firstLoad:function(){var e=this;return!e.total()&&e.lc_opts.firstLoad&&e.loadNextPhotos(function(){e._trigger("firstPhotosLoad",[])}),e},_findSizeClass:function(){var e,t,r=this;0<r.total()?(e=r.get(0).find(".preview")).length&&(t=e.prop("className").match(/(s\d+_\d+)/))&&(r.size_class=" "+t[1]):(t=Spaces.PREVIEW_TO_CLASS[r.lc_opts.apiData.Psize])&&(r.size_class=" "+t)},loadNextPhotos:function(i){var o,e,n,s=this;s._adapter.avail()?(s._first_load||s._findSizeClass(),o=s.total(),e=s._adapter.total(),n=0<e?Math.min(e,s.lc_opts.limit):s.lc_opts.limit,s.insertSpinners(n),s.update(),s._adapter.loadData(function(e){var t,r;if(s._adapter.render(e,o),t=s._adapter.total(),n,!s._adapter.avail())for(r=s.total()-t;r--;)s.remove(t);s._first_load||(s._findSizeClass(),s._first_load=!0),s.update(),s.lc_opts.gallery?require("gallery",function(){s._gallery_gid&&GALLERY.setGroupVisibleCount(s._gallery_gid,s._adapter.avail()?s._adapter.total():null),GALLERY.addPhoto(),GALLERY.update()}):s.el.find(".gview_link").removeClass("gview_link"),i&&i(),s._trigger("photosLoadChunk",[o,s.lc_opts.limit])},function(e){s.lc_opts.gallery&&require("gallery",function(){GALLERY.setGroupError(s._gallery_gid,e.message?e.message:L("Ошибка загрузки. "),function(){e.retry()})}),s._trigger("loadError",[e]),i&&i()},o,s.lc_opts.limit)):i&&i()},totalItems:function(){return this._adapter.total()},markSelected:function(e){return this.toggleSelected(e,!0)},isSelected:function(e){var t=this,r=t.el.find('[G^="'+e+'|"]').parent().find(".ico_photo_select, .ico_photo_selected").first();return r.hasClass("ico_photo_selected")},toggleSelected:function(e,t){var r,i=this,o=i.el.find('[G^="'+e+'|"]').parent().find(".ico_photo_select, .ico_photo_selected").first();return i.lc_opts.multiple||i.el.find(".ico_photo_selected").removeClass("ico_photo_selected").addClass("ico_photo_select"),r=o.hasClass("ico_photo_select"),(t!==undefined?t:r)?(o.removeClass("ico_photo_select"),o.addClass("ico_photo_selected")):(o.removeClass("ico_photo_selected"),o.addClass("ico_photo_select")),!r},getSelected:function(e,t){var r=[];return this.el.find(".ico_photo_selected").each(function(){r.push($(this).parent().children().first())}),r},hasSelected:function(e,t){return 0<this.el.find(".ico_photo_selected:first").length}}),window.LoadableCarousel=s,e=Class({Constructor:function(e,t){var r=this;r.opts=$.extend({},t),r.slider=e,r.default_opitons={},r.initialize&&r.initialize()},setup:function(){var e=this.slider.lc_opts;this._total=e.total,this._avail=e.hasMore},loadData:function(e,t,r,i){},render:function(){return""},updatePartial:function(){return this},params:function(){return this.default_options},total:function(){return this._total},avail:function(){return!!this._avail},reset:function(){return this._total=0,this._avail=!0,this}}),window.CarouselDataAdapter=e,t=Class({Extends:e,initialize:function(){this.default_options={apiMethod:"neoapi/files.getFiles",apiResult:"widgets"}},updatePartial:function(e){return this.render(e,0)},render:function(e,t){var r,i,o,n=this,s=e[n.slider.lc_opts.apiResult],a=n.slider;for(r=0;r<s.length;++r)null===s[r]?a.get(r).children().first().attr("data-not-found",1):a.replace(t+r,s[r]+(n.slider.lc_opts.select?'<span class="ico ico_photo_select"></span>':""));if(0==t&&n.slider.lc_opts.gallery){if(i=a.get(0).children().first(),!(o=Spaces.File.getMeta(i)))throw"Gallery group not found!";a._setupGallery(o.gid)}},setup:function(){e.prototype.setup.apply(this,arguments);this.slider.lc_opts.metric=this.slider.lc_opts.metric||this.getCarouselType()},getCarouselType:function(){var e=new Url(location.href).path.replace(/\/+/g,"/"),t=this.slider.lc_opts.apiData||{},r=this.slider.lc_opts.apiMethod;if("/"==e||-1<e.indexOf("/index")){if(1690==t.Dir)return"main_photo";if(4==t.Dir)return"main_video"}else{if(-1<e.indexOf("/anketa"))return"anketa_photo";if(-1<e.indexOf("/sections")&&"neoapi/dating"==r&&"search"==t.method)return"sections_datings"}return e+"-"+(t.method||"")+"-"+r},loadData:function(r,i,o,n,e){var s=this,t=extend({},s.slider.lc_opts.apiData,{O:o,L:n}),a=function(){return s.loadData(r,i,o,n,e)};e&&(t.IdS=e.nids,t.TyPes=e.types),Spaces.api(s.slider.lc_opts.apiMethod,t,function(e){if(s.slider._trigger("apiResult",[e]),0==e.code){var t=e[s.slider.lc_opts.apiResult];o+t.length>=e.count&&(s._avail=!1),s._avail&&t.length<n?(s._avail=!1,s._total=o+t.length):s._total=e.count,s._avail&&t.length!=n&&console.error("WTF??? Пришло неожиданное кол-во!",n,"!=",t.length," (offset: "+o+")"),r(e)}else e.code==Codes.COMMON.ERR_FREQ_LIMITER||e.code==Codes.AUTH.ERR_AUTH_ERROR&&(3==e.auth_errror||7==e.auth_errror)?(console.error(":("),setTimeout(function(){a()},3e3)):i&&i({type:"api",res:e,message:Spaces.services.processingCodes(e),retry:a})},{onError:function(e){i&&i({type:"network",message:e,retry:a})},GET:{carousel:s.slider.lc_opts.metric||null}})}}),window.AbstractCarouselAdapter=t,a={"abstract":{adapter:t}},$.fn.carousel=function(e,t){var r,i,o,n=this.first();if(!this.length)throw"Элемент карусели не найден!";return t=t||"abstract",(r=n.prop("__slider"))||(e=e||{},i=t||n.data("type"),o=a[i],n.removeData("type"),r=o?new s(n,$.extend(!0,{},o,n.data(),e)):new l(n,e),n.prop("__slider",r)),r},$.fn.slider=function(e){return $.fn.carousel.call(this,e,"default")}}),define("slider","onRequest",function(){$(function(){$(".carousel").each(function(){var e=$(this);e.hasClass("carousel-static")||e.carousel()})})});