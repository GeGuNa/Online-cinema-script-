define("comments","init",function(){var g=function(e){return'<div class="shdw comm text nl js-comment_restore" id="r'+e.id+'">'+e.widget+"</div>"},C=function(e){return e.url?'<div style="padding-left: 5px; padding-top: 5px"><img src="'+e.url+'" alt="" /></div><div class="stnd_padd" style="font-size:small;">'+L("Введите код:")+' <input type="text" name="captcha_code" size="4" value="" /></div>':""},y=function(){return'<span class="comment_date js-comment_spinner"><span class="ico ico_spinner"></span></span>'},o=function(){return'<span class="ico ico_spinner hide js-spinner"></span> '},a=function(e){return'<a href="#close-notif" class="tdn right"><span class="ico ico_remove js-comments_notif_close"></span></a>'+e},w=Date.now(),t=function(u){var f,e,p,i,h,c,s={ids:[],start:0},_=[],v=0,P=!1,r=!1,t="comments_"+Date.now(),n={initParams:function(){var e,t=this;s={ids:[],start:0},h=null,e=u.find(".js-comment_form"),(f=$.extend(u.find(".js-comments_list").data(),{form:e.parents("form"),textarea:e.find("textarea:first"),list:u.find(".js-comments_wrap"),pagination:u.find(".js-comments-pgn")})).commentsCnt=+f.commentsCnt||0,Spaces.notifications&&!f.lenta&&Spaces.notifications.setPlace(f.type,f.id,f.objectType),t.collectIds(),c=!1},init:function(){var e,g=this;g.initParams(),"operamini"!=Device.browser&&g.initDelete(),f.lenta&&g.setCommCnt(f.commentsCnt),e="operamini"==Device.browser?"body":u,$(e).on("click",".js-comm_menu_link",function(e){e.preventDefault();var t=$(this),n=t.parents(".js-comments_wrap > div");g.commentsMenu(n,t.data("menu"),t)}).on("click",".js-comm_do_compl",function(e){var t,n,a,o,i,s,r;e.preventDefault(),n=(t=$(this).parents(".js-comments_wrap > div")).find(".js-radio-complaint_reason.form-checkbox_checked input"),a=t.find("textarea"),o=$.trim(a.val()),s=!1,r={CK:null,Oid:i=t.data("comm_id"),Ot:f.type},a.length&&(n.length?o.length||(s=L("Что бы отправить жалобу нужно заполнить сообщение.")):s=L("Что бы отправить жалобу нужно выбрать причину."),r.R=n.val(),r.c=o),Spaces.view.setInputError(a,s),s||(t.find(".js-spinner").addClass("ico_spinner"),Spaces.api(a.length?"neoapi/complaints.complain":"neoapi/complaints.spamComplain",r,function(e){g.resetReplyForm(),0==e.code?(Spaces.showMsg(L("Жалоба успешно отправлена.")),$("#voted_"+f.type+"_"+i).remove()):Spaces.showApiError(e)},{onError:function(e){g.resetReplyForm(),Spaces.showError(e)}}))}).on("click",".js-comments_notif_close",function(e){e.preventDefault(),g.showMsg(!1)}).on("click",".js-comm_do_copy_link",function(e){e.preventDefault();var t=$(this),n=t.parents(".js-comments_wrap > div"),a=n.find('input[name="copy_link"]').data("link");g.commentsMenu(n,!1,t),Spaces.api("neoapi/common.copyURL",{url:a,CK:null}),$("#toolbar_payload").attr("data-clipboard",a)}),pushstream&&page_loader.ok()&&(u.on("click",".js-comments_subscribe",function(e){var t,n,a,o;e.preventDefault(),t=$(this),n=t.hasClass("js-comments_unsubscr"),t.hasClass("disabled")||(t.addClass("disabled"),a=function(){t.removeClass("disabled")},(o={CK:null,Oid:f.id,Ot:f.objectType})[n?"Off":"On"]=1,Spaces.api("neoapi/journal.subscribe",o,function(e){a(),0!=e.code?Spaces.showApiError(e):(u.find(".js-comments_subscr").toggleClass("hide",!n),u.find(".js-comments_unsubscr").toggleClass("hide",n))},{onError:function(e){Spaces.showError(e),a()}}))}).on("click",".js-comm_reply",function(e){var t=$(this),n=t.parents(".js-comments_wrap > div"),a=n.attr("id"),o=t.hasClass("js-clicked"),i=u.find(".js-comments_form"),s=!!n.find(".comm_hidden").length,r=i.find('input[name="hideComment"]');i.length&&(e.preventDefault(),g.resetReplyForm(),o||(c=!0,t.addClass("js-clicked"),u.find(".js-comments_form_reply").removeClass("hide"),u.find(".js-comments_form_user").empty().append($.trim(n.find(".user__nick .inl_bl").html())),n.after(i.data("reply_id",a)),r.prop("checked")!=s&&r.parent().click(),"desktop"==Device.type&&i.find("textarea").focus(),require("form_toolbar",function(){Toolbar.expand(i,!0)})))}).on("click",".js-comm_compl",function(e){e.preventDefault();var t=$(this),n=t.parents(".js-comments_wrap > div"),a=n.attr("id"),o=u.find(".js-tpl-comments_compl"),i=o.data("comm_id")!=a;g.resetReplyForm(),i&&(t.addClass("link_active"),n.after(o.data("comm_id",a)))}).on("click",".js-comm_close",function(e){e.preventDefault(),g.resetReplyForm()}),u.find(".js-comments_more-link").on("click",function(e){e.preventDefault();var t=$(this).find(".js-spinner");t.is(":visible")||(t.removeClass("hide"),g.getMoreMessages(function(){t.addClass("hide")},f.sort?_.length:f.commentsCnt-_.length-f.onPage,f.onPage))}),u.find(".js-comments_unread-link").on("click",function(e){e.preventDefault();var t=g.getMaxPage()+Math.ceil(v/f.onPage),n=$(this).find(".js-spinner");n.is(":visible")||(n.removeClass("hide"),g.loadPage(f.sort?1:t,{history:g.isActivePage(),onSuccess:function(){g.showMsg(!1),n.addClass("hide")},onError:function(){n.addClass("hide")}}))}),page_loader.on("shutdown",t,function(){g.reset(),pushstream.off(t)}),cookie.get("comments_list")&&(u.on("click",".pgn [data-p]",function(e){e.preventDefault(),g.loadPage($(this).data("p"))}),page_loader.router(function(e,t){if(t.state&&"comment_page"==t.state.route)return g.loadPage(g.getPage(),{history:!0,state:t.state}),!1})),f.lenta||pushstream.on("message",t,$.proxy(g.onLongPolling,g)).on("disconnect",t,function(){g.isActivePage()&&(P=!0)}),f.form.on("submit",function(e){var t,n,a,o,i,s,r,c,m,d,l,p;this.submit_btn&&"cfms"==this.submit_btn.name&&(e.preventDefault(),f.form.data("busy")||(t=$.trim(f.textarea.val()),n=f.textarea.data("maxlength"),a=!1,o=$(this.submit_btn),i=AttachSelector.getAttaches(f.form,!0),s=AttachSelector.instance(f.form),r=Url.serializeForm(f.form[0]),t.length||s&&(s.getTmpCnt()||i.length)?t.length>n&&(a=L("Комментарий не должен быть больше {0} {1}.",n,numeral(n,[L("символа"),L("символов"),L("символов")]))):a=L("Комментарий не должен быть пустым."),Spaces.view.setInputError(f.textarea,a),a||((c=function(e){f.form.data("busy",e),e?(f.textarea.attr("readonly","readonly"),o.data("old_name")||o.data("old_name",o.val()),o.val("Отправка").attr("disabled","disabled").css({opacity:.5})):(f.textarea.removeAttr("readonly"),o.val(o.data("old_name")).removeAttr("disabled").css({opacity:""}))})(!0),AttachSelector.isBusy()?AttachSelector.onDone(function(){c(!1),o.click()}):(m=g.isFullPage()&&g.isActivePage()&&!v,d=f.sort?1:m?g.getPage()+1:g.getPage(),l=u.find(".js-comments_form").data("reply_id"),(p=$.extend(g.getApiExtra(),{Type:f.type,Id:f.id,comment:t,Cr:l,atT:i,CK:null,captcha_code:r.captcha_code,Pag:!0,Com:f.lenta,from:f.form.find('input[name="from"]').val(),"private":r["private"],hideComment:r.hideComment}))[f.pageParam]=g.isActivePage()?d:g.getPage(),f.lenta&&delete p[f.pageParam],Spaces.api("neoapi/comments.add",p,function(a){var n,e,t,o,i,s;u.find(".js-captcha_widget").html(C({url:a.captcha_url})),0!=a.code?(c(!1),a.code!=Codes.COMMON.ERR_NEED_CAPTCHA&&(n=[],a.code==Codes.COMMENTS.ERR_INVALID?$.each(a.errors,function(e,t){n.push(t)}):n=[Spaces.apiError(a)],Spaces.view.setInputError(f.textarea,n.join("<br />")))):(f.textarea.val("").trigger("change"),AttachSelector.resetAttaches(f.form),e=function(){c(!1),g.showMsg(!1),!f.lenta&&a.notify&&g.showMsg(L("Ваш комментарий добавлен!")+' <a href="'+a.notify+'">'+L("Вернуться назад")+"</a>");var e,t,n=f.list;f.sort?(e=n.children().first(),t="page-up"):(e=n.children().last(),g.setPage(g.getPage()),t="page-down"),$("html, body").scrollTo(u.find('a[name="'+t+'"]'),{position:"visible"}),g.highlightNewComment(e,!0)},t=Math.ceil(a.cnt/f.onPage),i=function(){g.loadComments({page:f.sort?1:t},function(){e()},function(e){c(!1),Spaces.view.setInputError(f.textarea,e)})},(o=f.sort?1==d:t<=d)?(a.widget||(P=!0),a.cnt!=f.commentsCnt+1&&(P=!0)):P=!1,f.lenta&&(P=!1),g.resetReplyForm(),f.lenta&&a.cnt!=f.commentsCnt+1?(s=Math.min(f.onPage,_.length),g.getMoreMessages(function(){e()},f.sort?0:a.cnt-s,s)):!P&&o||f.lenta?(h=null,g.removeRestoreComment(),g.updateComments(!1,{comments:mkhash([[a.id,a.widget]]),newComment:!0}),g.setCommCnt(+a.cnt),f.lenta||f.pagination.html(a.pagination||""),e()):f.lenta||i())},{disableCaptcha:!0,onError:function(e){c(!1),Spaces.view.setInputError(f.textarea,e)}})))))}))},showMsg:function(e){u.find(f.sort?".js-comments_top_notif":".js-comments_bottom_notif").toggleClass("hide",!e).html(a(e))},commentsMenu:function(e,t,n){var a,o,i,s=e.attr("id"),r=e.find(".js-comm_menu:visible"),c=r.data("menu"),m=function(e,t){e.attr("id")&&!t?e.remove():e.toggleClass("hide",!t)};t||!r.length||c&&t==c?(r.length&&m(r,!1),r.length&&c==t||(a=e.find(".js-comm_menu"),t?(o=$(u.find(".js-tpl-comments_"+t).prop("outerHTML")).addClass("js-comm_menu"),a.after(o.attr("id","comm_menu_"+t+"_"+s)),m(o.data("menu",t),!0),"link"==t&&o.find('input[name="copy_link"]').val("[url="+e.data("link")+"]"+L("Ссылка на комментарий")+"[/url]").data("link",e.data("link"))):m(a,!0))):m(r,!1),i=0<e.find(".js-comm_menu:visible").length,e.find(".js-comm_menu_link").removeClass("js-clicked"),i&&n.addClass("js-clicked")},initDelete:function(){var i=this;u.find(".js-comments_wrap").on("click","a.ajax_delete",function(e){e.preventDefault();var t=$(this),n=t.parents(".js-comments_wrap > div"),a=t.data("action"),o=n.attr("id");"hide"==a||"unhide"==a?i.hideComment(o,"hide"==a):i.deleteComment(t.prop("href"),o,"delete",f.type)}).on("click","a.ajax_restore_message",function(e){if(h){e.preventDefault();var t=$(this),n=t.data("cmtid");$("#r"+n).find(".js-comment_spinner").removeClass("hide"),i.deleteComment(t.prop("href"),n,"restore_message",t.data("cmttype"))}})},highlightNewComment:function(e,t){$.support.nativeAnim&&e.find(".comm").each(function(){var e=$(this);e.addClass("comm_new"),setTimeout(function(){e.cssAnim("background","ease-out",t?450:2e3),e.removeClass("comm_new")},50)})},removeRestoreComment:function(){u.find(".js-comment_restore:first").remove();var e=new Url(location.href);e.query.Deleted&&(delete e.query.Deleted,delete e.query.CK,delete e.query.Ck,HistoryManager.replaceState(HistoryManager.state,document.title,e.url(!0)))},onLongPolling:function(e){var t=this;e.objectId==f.id&&e.commentType==f.type&&e.hash!=w&&(!f.canSeeDeleted&&e.hidden||(e.restored?t.isActivePage()&&(P=!0):e.act==Spaces.LongPollingTypes.COMMENT_ADD?(t.getCommPos(e.id),Spaces.notifications.isWindowActive()||(P=!0),c&&(P=!0),$("textarea:focus").length&&(P=!0),t.canLpInsert()&&!v?t.getMessageDelayed({id:e.id}):(++v,t.updateUnread())):e.act==Spaces.LongPollingTypes.COMMENT_DELETE&&t.isActivePage()&&(P=!0)))},updateUnread:function(){var e,t,n=this;u.find(".js-comments_unread").toggleClass("hide",!v),0<v&&(e=new Url(location.href),n.updateUrlPage(e,f.sort?1:n.getPage()+Math.ceil(v/f.onPage)),t=numeral(v,[L("+$n новый комментарий"),L("+$n новых комментария"),L("+$n новых комментариев")]),u.find(".js-comments_unread-link").prop("href",e.url()).html(o()+t),Spaces.notifications&&!Spaces.notifications.isWindowActive()&&Spaces.notifications.showNewEvent(t,{oneTab:!0,notif:!1}))},updateUrlPage:function(e,t){delete e.query[f.pageParam],delete e.query.p,delete e.query.P,delete e.query.cp,delete e.query.scp,delete e.query.Scp;var n=RegExp("/"+f.pageParam+"\\d+(/|$|\\?)","i");n.test(e.path)?e.path=e.path.replace(n,"/"+f.pageParam+t+"$1"):e.query[f.pageParam]=t},loadPage:function(a,o){var i,s=this;o=o||{},Spaces.cancelApi(e),i=o.state&&o.state.page_id||Date.now(),e=s.loadComments({page:a,page_id:i,ajaxify:!0},function(e){var n,t=f.sort?"page-up":"page-down";o.history||f.lenta||(HistoryManager.updateState(function(e){e.route="comment_page"}),(n=new Url(location.href)).hash=t,s.updateUrlPage(n,a),HistoryManager.pushState({route:"comment_page",page_id:i},document.title,n.url())),$("html, body").scrollTo(u.find('a[name="'+t+'"]'),{position:"visible"}),u.find(".js-more_link").each(function(){var e=$(this),t=new Url(e.prop("href"));s.updateUrlPage(n,s.getPage()),e.prop("href",t.url())}),P=!1,o.onSuccess&&o.onSuccess()},function(e){Spaces.showError(e),o.onError&&o.onError(e)})},loadComments:function(e,t,n){var a,o,i=this,s=$.extend(i.getApiExtra(),{Pag:!0});e=$.extend({page:1,ajaxify:!1,page_id:Date.now()},e),s[f.pageParam]=e.page,a=function(e){0!=e.code?(delete s.sid,n&&n(Spaces.apiError(e))):(i.resetReplyForm(),i.reset(),f.list.html(e.comments.join("")),f.pagination.html(e.pagination||""),i.collectIds(),i.setCommCnt(+e.cnt),i.setPage(i.getPage()),Loader.loaded("gallery",function(){GALLERY.addPhoto()}),Loader.loaded("music",function(){MusicPlayer.reset()}),Loader.loaded("video_player",function(){VideoPlayer.destroyNotAvail()}),t&&t())},e.ajaxify?(s.method="read",o=new Url("/neoapi/comments",!0),page_loader.request(e.page_id,o,s,a,function(e){n&&n(e.error)})):Spaces.api("neoapi/comments.read",s,a,{retry:20,onError:function(e){n&&n(e)}})},hideComment:function(t,e){var n,a,o=this,i=$("#"+t);i.data("busy")||(i.data("busy",!0),i.find(".comment_date").addClass("hide").after(y()),n=function(){i.find(".js-comment_spinner").remove(),i.find(".comment_date").removeClass("hide"),i.removeData("busy")},(a={Ec:t,Id:f.id,Type:f.type,CK:null})[e?"Hc":"Rc"]=1,Spaces.api("neoapi/comments.add",a,function(e){0==e.code?o.updateComments(!1,{comments:mkhash([[t,e.widget]]),newComment:!0}):(Spaces.showApiError(e),n())},{onError:function(e){Spaces.showError(e),n()}}))},deleteComment:function(e,n,a,t){var o,i,s,r,c,m,d=this,l=$("#"+n);l.data("busy")||("delete"==a?(o="neoapi/comments.delete",(i=new Url(e).query).type=t):(o=e,i={}),i.hash=w,i.Ch=!0,i.Pag=!1,r=d.getPageDir(),"delete"==a&&(r<0?_.length<2&&(s=d.getPage()-1,i.O=(s-1)*f.onPage,i.L=f.onPage,i.Pag=!0,i[f.pageParam]=s):(!r||0<r)&&(c=d.getPage()*f.onPage-1,i.O=c,i.L=1,i.Pag=!0,i[f.pageParam]=d.getPage())),l.find(".comment_date").addClass("hide").after(y()),m=function(e){e.removeData("busy"),e.find(".js-comment_spinner").remove(),e.find(".comment_date.hide").removeClass("hide")},l.data("busy",!0),p=Spaces.api(o,i,function(e){if(m(l),d.resetReplyForm(),0==e.code){if("delete"==a)d.removeRestoreComment(),l.after(g({id:n,widget:e.restore_widget})),h={id:n,widget:l.detach(),fromLast:d.isPreloadEnd(),pagination:i.Pag&&f.pagination.children().detach()},d.setCommCnt(+e.cnt),d.updateComments([n],{comments:mkhash([[n,null]]),allowNewPage:!1}),e.comments&&d.updateComments(!1,{comments:e.comments,allowNewPage:!1}),i.Pag&&(f.pagination.html(e.pagination||""),s&&d.setPage(s));else if("restore_message"==a){var t=d.isFullPage();d.updateComments([h.id],{comments:mkhash([[h.id,h.widget]]),allowNewPage:t&&h.fromLast}),d.setCommCnt(f.commentsCnt+1),t&&h.fromLast&&d.setPage(d.getPage()+1),$("#r"+h.id).remove(),h.pagination&&f.pagination.empty().append(h.pagination),m($("#"+h.id)),h=null}}else Spaces.showApiError(e)},{onError:function(e){m(l),Spaces.showError(e)}}))},getApiExtra:function(){var e;return f.lenta?e={id:f.id,Id:f.id,Read:f.id,Link_id:Spaces.params.link_id}:(delete(e=f.request).scp,delete e.p,delete e.P,delete e[f.pageParam],delete e.Deleted,delete e.CK,delete e.Vck,delete e.Dtype),$.extend({},e,{Type:f.type,Link_id:e.Link_id||e.link_id||Spaces.params.link_id,hash:w,Id:e.Id||e.id,passed:1})},getMoreMessages:function(a,e,t){var o=this;Spaces.cancelApi(i),i=Spaces.api("neoapi/comments.read",$.extend(o.getApiExtra(),{O:e,L:t,Pag:!1,Ch:!0}),function(e){var t,n;a&&a(),i=!1,0==e.code?(0,$.each(e.comments,function(){0}),t=_.length,n=u.outerHeight(),o.updateComments(!1,{newComment:!0,comments:e.comments}),_.length-t<f.onPage&&(r=!0),o.setCommCnt(+e.cnt),f.sort||$("html, body").scrollTop($(window).scrollTop()+(u.outerHeight()-n))):Spaces.showError(L("Ошибка получения комментариев:")+Spaces.apiError(e))},{retry:10,onError:function(){a&&a(),i=!1}})},getMessageDelayed:function(e){var t,n,a,o=this;s.ids.push(e.id),!s.request&&0<s.ids.length&&(t=s.ids,s.ids=[],n={},f.sort||(n[f.pageParam]=o.getPage()),a=!0,s.request=Spaces.api("neoapi/comments.read",$.extend(o.getApiExtra(),{IdS:t,Pag:a,Ch:!0},n),function(e){s.request=!1,0==e.code?(o.updateComments(t,{newComment:!0,comments:e.comments}),o.setCommCnt(+e.cnt),a&&f.pagination.html(e.pagination||"")):Spaces.showError(L("Ошибка получения комментариев:")+Spaces.apiError(e))},{retry:10,onError:function(){s.request=!1}}))},updateComments:function(e,t){var n,a,o,i,s=this;if(t=$.extend({allowNewPage:!0,updateCnt:!1,newComment:!1},t),e)for(n=0;n<e.length;++n)(a=e[n])in t.comments||(t.comments[a]=null),$.inArray(+a,_)<0&&_.push(a);else for(a in t.comments)$.inArray(+a,_)<0&&_.push(+a);for(_.sort(function(e,t){return f.sort?t-e:e-t}),_,n=0;n<_.length;++n)(a=_[n])in t.comments&&(null!==t.comments[a]?ge("#"+a)?$("#"+a).replaceWith(t.comments[a]):(o=_[n-1],h&&Math.max(o,a)>h.id&&Math.min(o,a)<h.id&&(o="r"+h.id),o?$("#"+o).after(t.comments[a]):f.list.prepend(t.comments[a]),s.highlightNewComment($("#"+a),!1)):($("#"+a).remove(),_.splice(n,1),--n));if(_.length>f.onPage&&!f.lenta)if(t.newComment?f.sort:!t.allowNewPage){for(n=f.onPage;n<_.length;++n)$("#"+_[n]).remove();_=_.slice(0,f.onPage)}else{for(i=f.onPage*Math.floor(_.length/f.onPage),n=0;n<i;++n)$("#"+_[n]).remove();_=_.slice(i)}Loader.loaded("gallery",function(){GALLERY.addPhoto()})},resetReplyForm:function(){var e,t,n=u.find(".js-comments_form");u.find(".js-comments_form_reply").addClass("hide"),u.find(".js-comm_reply.js-clicked").removeClass("js-clicked"),u.find(".js-comments_form_wrap").append(n.removeData("reply_id")),(e=n.find('input[name="hideComment"]')).prop("checked")&&e.parent().click(),(t=u.find(".js-tpl-comments_compl").removeData()).find(".ico_spinner").removeClass("ico_spinner"),u.find(".js-comments-tpl").append(t),u.find(".js-comm_compl.link_active").removeClass("link_active"),require("form_toolbar",function(){Toolbar.expand(n,!1)}),c=!1},getPageDir:function(){var e=this;return(f.sort?1<e.getMaxPage()&&e.isLastPage():e.isActivePage())?-1:1<e.getMaxPage()&&1<e.getPage()&&e.getPage()<e.getMaxPage()?0:1},getCommPos:function(e){var t=Math.min(_[0],_[_.length-1]),n=Math.max(_[0],_[_.length-1]);return t<=e&&e<=n?0:e<t?-1:1},setPage:function(e){var t=this,n=new Url(location.href);t.updateUrlPage(n,e),n.hash="page-up",f.pagination.find(".pgn").data("page",e),f.lenta||HistoryManager.replaceState(HistoryManager.state,document.title,n.url(!0))},getPage:function(){var e=f.pagination.find(".pgn");return 0<e.length?e.data("page"):this.getMaxPage()},getMaxPage:function(){return Math.max(1,Math.ceil(f.commentsCnt/f.onPage))},canLpInsert:function(){return this.isActivePage()&&!this.isFullPage()&&!P},isActivePage:function(){var e=this.getPage();return f.sort?1==e:e==this.getMaxPage()},isPreloadEnd:function(){return f.sort?this.isLastPage()&&!this.isActivePage():!this.isLastPage()&&this.isActivePage()},isLastPage:function(){var e=this.getPage();return f.sort?e==this.getMaxPage():1==e},isFullPage:function(){return _.length>=f.onPage},setCommCnt:function(n){var a,e,t;f.commentsCnt=n,a=f.list.find(".js-comment_restore").length,u.find(".js-comments_cnt .js-cnt").text(n),u.find(".js-comments_show").each(function(){var e=$(this),t=e.data();"cnt"==t.show?e.toggleClass("hide",!(a+n)):"cnt"==t.hide&&e.toggleClass("hide",!!(a+n))}),f.lenta&&(e=r?0:Math.max(0,Math.min(10,n-_.length)),t=numeral(e,[L("Предыдущий $n комментарий"),L("Предыдущие $n комментария"),L("Предыдущие $n комментариев")]),u.find(".js-comments_more-link").html(o()+t),u.find(".js-comments_more").toggleClass("hide",!e))},collectIds:function(){_=[],f.list.children().each(function(){_.push(+this.id)})},reset:function(){Spaces.cancelApi(e),Spaces.cancelApi(p),Spaces.cancelApi(i),Spaces.cancelApi(s.request),h=null,v=0,P=!1,s.ids=[],this.updateUnread()}};n.init(u)};define("comments","onRequire",function(){Loader.ready(function(){$(".js-comments").each(function(){var e=$(this);e.data("comments")||e.data("comments",new t(e))})})})});