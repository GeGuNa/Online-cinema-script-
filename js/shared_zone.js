define("shared_zone","init",function(){function _(){return $(".pgn:first")}var d,S={1:Spaces.FILES_LIST.NEW_FILES,2:Spaces.FILES_LIST.POPUlAR_NOW,3:Spaces.FILES_LIST.POPULAR_ALLTIME,4:Spaces.FILES_LIST.POPULAR_MONTH},f=function(){return'<span class="ico f__ico_spinner2 m" /> <span class="m">'+L("Загрузка...")+"</span>"};define("shared_zone","onRequest",function(){var n,a,e,t,i,l,r,s,o,p,c,g;page_loader.ok()&&((n=$("#sz_gallery_loader")).data("moder")&&(c="sz_gallery",g="true"===Spaces.LocalStorage.get(c),$("#sz_gallery_sw").click(function(){Spaces.LocalStorage.set(c,!g),Spaces.redirect()}).css("opacity",g?1:.5).attr("title",L("Просмотрщик")).show(),!g)||(a=n.data("type"),e=new Url(location.href),i="neoapi/files.getFiles","user"==a?t={address:e.val("address"),name:e.val("name"),Link_id:e.val("Link_id"),Lt:e.val("Lt")||e.val("lt")||Spaces.FILES_LIST.DIRS,Dir:e.val("Dir")||e.val("dir")||0,Mode:Spaces.RENDER_MODE.TILE}:"sz"==a&&(t={Link_id:e.val("Link_id"),Lt:S[e.val("list")]||e.val("Lt")||e.val("lt")||Spaces.FILES_LIST.DIRS,Dir:e.val("Dir")||e.val("dir")||0,Sz:1,Mode:Spaces.RENDER_MODE.TILE}),l=_(),r=l.data()||{},new Url(r.url),s=r.on_page,o=r.count,p=s*(r.page-1),GalleryLoader.setupLoaders(n.data({apiData:t,apiMethod:i,total:o,offset:p,limit:s,gc:!0,hasMore:0<l.length,itemWrap:".js-file_item"})),n.on("galleryExit",function(a,e){var t,n,i;l.length&&((t={Op:r.on_page,Flags:r.flags,url:r.url,pn:r.param,Cnt:e.total})[r.param]=e.page,(n=_()).data("page")!=e.page&&((i=n).find(".pgn__range").html(f()),i.find(".js-pagenav_toggle.pgn__button_press").click(),i.find(".pgn__link, .pgn__button").addClass("pgn__link_disabled"),i.click(function(a){a.preventDefault(),a.stopPropagation()}).css("pointer-events","none"),Spaces.cancelApi(d),d=Spaces.api("neoapi/common.getPagination",t,function(a){0==a.code?_().off().replaceWith(a.pagination):Spaces.showError(a)},{retry:5})))}),n.on("galleryPageChanged",function(a,e){var t;l.length&&(0<e.page-e.lastPage?e.prevFiles.append(n.find(".js-file_item")):e.nextFiles.prepend(n.find(".js-file_item")),n.append(e.files),(t=new Url(location.href)).query[r.param]=e.page,HistoryManager.replaceState(HistoryManager.state,document.title,t.url(!0)),HistoryManager.pushState(HistoryManager.state,document.title,t.url()))})))})});