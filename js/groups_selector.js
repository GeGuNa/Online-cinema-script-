define("groups_selector","init",function(){function h(e){var t;return(t=e.match(/(\w)d_(\d+)$/))?{place:"removable",id:t[2],type:t[1]}:(t=e.match(/^gl(\w+)$/))?{place:"checbox",prefix:t[1],type:t[1]}:(t=e.match(/^GlS(.*?)_(\w)$/))?{place:"checbox",prefix:t[1],type:t[2]}:(t=e.match(/^Gl([SRA])(.*?)_(\w)(\d+)?$/))?{place:"button",id:t[4],prefix:t[2],type:t[3]}:null}var f,s=function(e){return'<div class="dropdown-menu_text oh content-bl__sep no-shadow"><table class="table__wrap table__wrap-layout"><tr><td class="table__cell table__cell_large-ico"><div class="ico ico_no_results"></div></td><td class="table__cell">'+L("Пользователь не найден.")+"</td></tr></table></div>"};UniversalSearch.register("groups_list",{apiMethod:"neoapi/user_groups.selector_autocomplete",apiData:{},param:"sq",results:"found",hideEmpty:!0,render:{activeClass:"list-link__wrap_hover",showOnFocus:!0,hideEmpty:!0,inputActiveClass:"triangle-show js-clicked"},onBeforeSend:function(e,t){$('[name$="_psq"]').val(e);var n=Url.serializeForm(this.el.parents("form")[0]);t.GlS_u=n.GlS_u,t.GlS_e=n.GlS_e,t.s=n.s},onRender:function(e,t,n){var r,a=[];if(t.found.length)for(r=0;r<t.found.length;++r)a.push("<div>",t.found[r],"</div>");else a.push(s());e.html(a.join(""))},onResult:function(e,t){f=e}}),UniversalSearch.register("groups_list_search",{apiMethod:function(){var e=new Url(this.el.parents("form").attr("action"));return e.path="/ajax"+Date.now()+e.path,e.url()},apiData:{},param:"sq",noapi:!0,results:"found",onBeforeSend:function(e,t){$('[name$="_psq"]').val(e),extend(t,Url.serializeForm(this.el.parents("form")[0]))},onRender:function(e,t,n){var r,a=$(".js-groups_pgn");a.empty(),e.empty(),t.content&&(r=$("<div>").html(t.content),$(".js-groups_remove_wrap").replaceWith(r.find(".js-groups_remove_wrap")),a.empty().append(r.find(".js-groups_pgn").children()),e.empty().append(r.find(".js-usearch_list").children()))}}),define("groups_selector","onRequest",function(){function p(e,t,n){var r,a,s,i,o,l,p=e.find(".js-groups_remove_wrap"),u=p.find(".js-groups_remove"),c=p.find(".js-groups_removed");if(t)for(n?u.append(t[0]):c.append(t[0]),r=1;r<t.length;++r)$(t[r]).remove();a=u.children().length,s=0,u.children().each(function(){-1!=$(this).text().indexOf("@")&&++s}),$(".js-groups_show").each(function(){var e=$(this),t=e.data("min")||1;e.toggleClass("hide",a<t&&!(e.data("email")&&0<s))}),p.toggleClass("hide",!a),i=e.data(),o=e.find(".js-groups_remove .s-property").length,l=e.find('.js-search__input[data-type="groups_list"]'),i.max_cnt&&l.toggleClass("hide",o>=i.max_cnt)}function u(e,t,n,r){var a=d(e,h(t).type,n);a.length&&!r&&a.remove(),!a.length&&r&&e.append(ce("input",{name:t,value:n,type:"hidden"}))}function c(e,t,n,r){var a,s,i,o=h(t);o&&(u(e,t,n,r),a=e,s=o.type,i=n,p(e,a.find("input:submit").filter(function(){var e=h(this.name);return e&&e.type==s&&i==e.id&&"removable"==e.place}).parents(".s-property"),r))}function d(e,t,n){return e.find("input:hidden").filter(function(){var e=h(this.name);return e&&e.type==t&&n==this.value})}page_loader.push("shutdown",function(){f=null}),$("#main").on("click",".js-groups_list .js-usearch_list > *",function(e){var t,n,r,a,s,i,o,l,p;if(f&&(e.preventDefault(),n=(t=$(this)).index(),r=f&&f.found[n],!t.find(".error__item").length&&f&&r)){for(a=$(e.target).parents(".js-groups_list"),s=f.params[n],i=a.find(".js-groups_remove"),o=f.removables[n],i.show().append(o),l=0;l<s.length;++l)u(a,(p=s[l]).name,p.value,!0),c(a,p.name,p.value,!0);a.find(".js-search__input").focus().val("").trigger("input").blur()}}).on("addremove",function(e,t){e.preventDefault();var n=$(e.target),r=n.parents(".js-groups_list");c(r,n.data("hidden_name"),n.data("hidden_value"),t.state),p(r),tick(function(){$(".js-usearch_parent").usearch().refreshSearch()})}).on("click",".js-removable_remove",function(e){var t,n,r,a=$(this),s=h(this.name),i=a.parents(".js-groups_list"),o=d(i,s.type,s.id),l=(t=i,n=s.type,r=s.id,t.find("input:submit").filter(function(){var e=h(this.name);return e&&e.type==n&&r==e.id&&"button"==e.place}).parents(".js-addremove"));l.data("checked")?(e.preventDefault(),l.click()):o.length&&(e.preventDefault(),o.remove(),p(i,a.parents(".s-property"),!1)),tick(function(){$(".js-usearch_parent").usearch().refreshSearch()})})})});