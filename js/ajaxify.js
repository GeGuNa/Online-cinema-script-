define("ajaxify","init",function(){var m,w,e,c=/^\/(p\/|m\/|f\/|v\/|advertise|neoapi|api|capcha\/|captcha\/|i\/|js\/|css\/|\w{2}\/[a-f0-9]{32})/i,r=/(\s|^)(no_ajax)(\s|$)/,u=/^br|aquatika|bratva|bt|drako|farma|ferma|gbn|generals|gfarm|gonki|hata|heroes|li|looters|mdog|millioner-online|mt|naemniki|nazone|nebomobi|redline|sb|vi|vkletke|voindorog|voyna|wartank|wekings$/,E=["reklama","sidebar_reklama","rightbar_reklama","rightbar_app","widgets.partners"],t=function(){return'<div id="ajax_loader" style="display: none"><div class="ajax-loader__cancel" id="ajax_cancel"><span class="ico ico_remove"></span></div></div>'},T=REVISION,o=document.createElement("a"),x=0,D=function(e){var t,a,r,o,n,i,s,l,c,u=[],d={hidden:1,reset:1,file:1,image:1,buttom:1,submit:1},p=e.getElementsByTagName("form");for(t=0;t<p.length;++t){for(a={id:p[t].getAttribute("id"),name:p[t].getAttribute("name"),radios:{},texts:{},checkboxes:{},selects:{}},r=p[t],o=0;o<r.elements.length;++o)if(i="INPUT"!=(n=r.elements[o]).tagName?n.tagName:n.type.toLowerCase(),"INPUT"!=n.tagName||!d[i])if("SELECT"==i)if(a.selects[n.name]===undefined&&(a.selects[n.name]=[]),n.multiple){for(s={},l=n.getElementsByTagName("option"),c=0;c<l.length;++c)s[l[c].value]=l[c].selected;a.selects[n.name].push(s)}else a.selects[n.name].push(n.value);else"radio"==i?n.checked&&(a.radios[n.name]=n.value):"checkbox"==i?(a.checkboxes[n.name]===undefined&&(a.checkboxes[n.name]={}),a.checkboxes[n.name][n.value]=n.checked):(a.texts[n.name]===undefined&&(a.texts[n.name]=[]),a.texts[n.name].push(n.value));u.push(a)}return u},C=function(e,t){var a,r,o,n,i,s,l,c,u,d,p,f,m,_,h,g=e.getElementsByTagName("form"),v={},b=0;for(a=0;a<g.length;++a)o=(r=g[a]).getAttribute("id"),n=r.getAttribute("name"),v[o?"#"+o:n?":"+n:b++]=r;for(i=function(e,t,a,r){var o,n,i;if(e!==undefined)for(e.length===undefined&&(e=[e]),o={hidden:1,reset:1,file:1,image:1,buttom:1,submit:1,radio:1,checkbox:1},n=0;n<e.length;++n)i="INPUT"!=e[n].tagName?e[n].tagName:e[n].type.toLowerCase(),(":text"!=t||o[i])&&i!=t||a!==undefined&&null!==a&&a!=e[n].value||r(e[n])},a=b=0;a<t.length;++a)if(r=v[(s=t[a]).id?"#"+s.id:s.name?":"+s.name:b++]){for(l in s.selects)for(c=0,u=r.getElementsByTagName("select"),d=0;d<u.length&&(p=u[d],s.selects[l][c]!==undefined);++d)if("object"==typeof s.selects[l][c]){for(f=p.getElementsByTagName("option"),m=0;m<f.length;++m)f[m].selected=!!s.selects[l][c][f[m].value];c++}else for(f=p.getElementsByTagName("option"),_=!1,m=0;m<f.length;++m)(f[m].selected=!_&&f[m].value==p.value)&&(_=!1);for(l in s.radios)i(r.elements[l],"radio",null,function(e){e.checked=e.value==s.radios[l]});for(l in s.checkboxes)i(r.elements[l],"checkbox",null,function(e){e.checked=!!s.checkboxes[l][e.value]});for(l in s.texts)h=0,i(r.elements[l],":text",null,function(e){s.texts[l][h]!==undefined&&(e.value=s.texts[l][h++])})}},d=function(){function r(e){a(),document.domain=location.host.toString().match(/[a-zA-Z-_\d]+\.[a-zA-Z-_\d]+\.?$/)[0];var t="iframe_xhr_transport";-1<navigator.userAgent.indexOf("MSIE 7")?l=document.createElement('<iframe src="javascript:false;" name="'+t+'">'):((l=document.createElement("iframe")).src="javascript:false;",l.name=t),l.style.display="none",l.id=t,"string"==typeof e&&(l.src=e),document.body.appendChild(l),d=!(u=!1)}function s(e,t,a){!0!==a&&!1!==a||(a=+a),a!==undefined&&e.appendChild(i(t,a))}function i(e,t){var a=document.createElement("input");return a.type="hidden",a.name=e,a.value=t,a}function a(){if(c&&(c.parentNode.removeChild(c),c=null),l){if(!d){try{l.stop()}catch(e){}try{l.execCommand("stop")}catch(e){}try{l.contentWindow.document.execCommand("stop")}catch(e){}l.src="javascript:false;"}l.parentNode.removeChild(l),l=null}}function e(e){a(),d=!1,setTimeout(function(){t.always&&t.always(),t.error&&t.error(e)},0)}function o(){e(!1)}function n(){d=!1,setTimeout(function(){u||d||(a(),e(!0))},1)}var l,c,u=!1,d=!1,t={};return{get:function(e){r(e)},post:function(e,t,a){r(null),c=function(e,t,a,r){var o,n,i=document.createElement("form");for(o in i.action=e,i.method=t,i.target="iframe_xhr_transport",i.name="iframe_form",i.style.display="none",r&&(i.enctype=r),a)if(a[o]instanceof Array)for(n=0;n<a[o].length;++n)s(i,o,a[o][n]);else s(i,o,a[o]);return i}(e,"POST",t,a?"multipart/form-data":""),document.body.appendChild(c),l.onload=n,l.onerror=o,c.submit()},formSend:function(e,t){r(null),e=function(e,t){var a,r,o,n=document.createElement("form");for(n.action=t||e.action,n.method=e.method,n.enctype=e.enctype,n.encoding=e.encoding,n.target="iframe_xhr_transport",n.name="iframe_form",n.style.display="none",a=0;a<e.elements.length;++a)r=e.elements[a],o=r.type.toLowerCase(),r.name.length&&("radio"!=o&&"checkbox"!=o||r.checked)&&("submit"!=o||r==e.submit_btn)&&n.appendChild(i(r.name,r.value));return n}(e,t),document.body.appendChild(e),e.submit()},_data:function(e){u=!0,a(),setTimeout(function(){t.always&&t.always(),t.success&&t.success(e)},0)},abort:a,setCallbacks:function(e){t=extend({success:null,error:null,always:null},e)}}}();window.IFrameXHR=d,w={default_id:null,callbacks:{},old_url:null,cur_url:null,state:null,_startup_url:null,init:function(){w.old_url=location.href,w.cur_url=location.href,window.onpopstate=w.handler,w._startup_url=location.href},setDefault:function(e){w.default_id=e},add:function(e,t){w.callbacks[e]=t},remove:function(e){delete w.callbacks[e]},clean:function(){for(var e in w.callbacks)w.default_id!=e&&delete w.callbacks[e]},handler:function(e){if(!e.state&&history.state&&(e.state=history.state),w.state=e.state,w._startup_url==location.href)return console.error("prevent html5 history bug"),w._startup_url=null,!1;w._startup_url&&(w._startup_url=null),w.old_url=w.cur_url,w.cur_url=document.location.href,Url.onlyHashChanged(w.cur_url,w.old_url)||(Spaces.referer=w.old_url,spaces_track(document.location.href,document.title,w.old_url));var t=w.default_id;return e.state&&e.state.route&&w.callbacks[e.state.route]!==undefined&&(t=e.state.route),t&&w.callbacks[t](e),e.preventDefault(),!1},pushState:function(e,t,a){w.state=e||{},w._startup_url&&(w._startup_url=null),e=e||{},w.old_url=document.location.href,window.history.pushState(e,t,a),w.cur_url=document.location.href,Url.onlyHashChanged(w.cur_url,w.old_url)||(Spaces.referer=w.old_url,spaces_track(document.location.href,document.title,w.old_url))},replaceState:function(e,t,a){e!==undefined&&(w.state=e),w.old_url=document.location.href,window.history.replaceState(e,t,a),w.cur_url=document.location.href,w._startup_url&&w._startup_url!=document.location.href&&(w._startup_url=null)},updateState:function(e){var t;try{t=history.state}catch(a){}t||(t=w.state||{}),e(t),w.replaceState(t,null,null)}},window.HistoryManager=w,e=Class({Constructor:function(){var e,t=this;$.extend(t,{page_no_cache:!1,active_reqs:0,refresh_url:null,refresh_interval:null,pages_id:{},page_cache_time:18e5,disabled:!1,prev_url:null,last:{link_id:0,sid:"0"},callbacks:{},user_id:Spaces.params.nid,_rnd:0}),e="desktop"==Device.type&&"msie"!=Device.browser&&"safari"!=Device.browser&&!("chrome"==Device.browser&&63<=Device.v),/force_ajax_transport=1/i.test(document.cookie)?e=!1:/force_iframe_transport=1/i.test(document.cookie)&&(e=!0),t.opts={iframe_transport:e,loading_indicator:!e},t.ok()&&(t.onShutdown("loader_onnewrequest",Loader.onNewRequestHandler,!0),w.setDefault("common"),w.add("common",function(e){t.loadPage({url:document.location.href,state:e.state,history:!1,scroll:!1,from_history:!0})||location.assign(document.location.href)}),t.on("shutdown","page_no_cache",function(){t.page_no_cache=!1},{persist:!0})),"operamini"!=Device.browser&&$(function(){t.setup()})},handlers:{onLinkClick:function(e,t){if(r.test(this.className))return!0;if(e.ctrlKey)return!0;if("_blank"==this.getAttribute("target"))return!0;var a=this.getAttribute("data-android-app");return a&&(a=JSON.parse(a)),this.href||(o.href=this.getAttribute("href"),this.href=o.href),t.loadPage({url:this.href,app:a})?(e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),!1):("UC-CLICK"==this.nodeName.toUpperCase()&&(location.href=this.href),!0)},onFormSubmit:function(e,t){return!!r.test(this.className)||(!t.loadPage({url:this.action,form:this})||(e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),!1))}},setup:function(){var e,a=this;a.invalid_page=!(ge("#main_page_footer")||ge("#footer")||ge("#navi_footer")||ge("#navi")),$.event.special.click||($.event.special.click={postDispatch:null}),$.event.special.submit||($.event.special.submit={postDispatch:null,trigger:null}),$.event.special.click.postDispatch=function(e){var t=e.ajaxify&&e.ajaxify.el;if((e.ajaxify||e.isPropagationStopped()||e.isImmediatePropagationStopped())&&(!e.originalEvent||!1!==e.originalEvent.returnValue&&!e.originalEvent.defaultPrevented)&&!e.isDefaultPrevented()){if(!t)for(t=e.target;t&&"A"!=t.nodeName.toUpperCase()&&"UC-CLICK"!=t.nodeName.toUpperCase();)t=t.parentNode;t&&!1===a.handlers.onLinkClick.call(t,e,a)&&e.preventDefault()}},$.event.special.submit.postDispatch=function(e){var t=e.ajaxify&&e.ajaxify.el;if((e.ajaxify||e.isPropagationStopped()||e.isImmediatePropagationStopped())&&(!e.originalEvent||!1!==e.originalEvent.returnValue&&!e.originalEvent.defaultPrevented)&&!e.isDefaultPrevented()){if(!t)for(t=e.target;t&&"FORM"!=t.nodeName.toUpperCase();)t=t.parentNode;t&&!1===a.handlers.onFormSubmit.call(t,e,a)&&e.preventDefault()}},$("body").on("click","a, uc-click",function(e){e.ajaxify={el:this}}).on("submit","form",function(e){e.ajaxify={el:this}}),window.pushstream&&pushstream.on("message","ajaxify",function(e){e.act==Spaces.LongPollingTypes.REFRESH_WIDGETS&&(a.current_tab_widgets_updated||a.refreshWidgets(e.widgets&~Spaces.WIDGETS.FOOTER),a.current_tab_widgets_updated=!1),e.act==Spaces.LongPollingTypes.SETTINGS&&a.updateSettings(e.newSettings);var t=e.session_ctime||e.data&&e.data.session_ctime;e.act!=Spaces.LongPollingTypes.DEVICE_TYPE_CHANGE&&e.act!=Spaces.LongPollingTypes.LOGOUT||t!=Spaces.params.sid||a.disable(e.device_type!=Device.id)}),a.ok()&&(window.PAGE_REFRESH&&(e=PAGE_REFRESH.params.match(/^(\d+);\s*url=(.*?)$/i))&&(a.setRefresh(e[2],e[1]),PAGE_REFRESH.timer&&clearTimeout(PAGE_REFRESH.timer)),$("#main_shadow").prepend(t()),$("#ajax_cancel").click(function(e){e.preventDefault(),a.cancel()}))},onShutdown:function(e,t,a){return this.on("shutdown",e,t,a)},onRequestStart:function(e,t){return this.on("requeststart",e,t,!0)},onRequestEnd:function(e,t){return this.on("requestend",e,t,!0)},setRefresh:function(e,t){var a=this;a.refresh_interval&&(clearInterval(a.refresh_interval),a.refresh_interval=null,a.refresh_url=null),e&&(a.refresh_url=e,console.error("set refresh: "+e+", "+t),a.refresh_interval=setInterval(function(){a.loadPage({url:a.refresh_url})},1e3*t))},loadPage:function(d){var p,e,f,t,m,_,a,r,o,h,g,v,n,b,i,S,k,s,l,y=this;if(d=$.extend({url:"",form:null,history:!0,state:null,scroll:!0,from_history:!1,app:!1},d),$(document.body),d.form&&(e=d.form.getAttribute("enctype"),(p=e&&"multipart/form-data"==e.toLowerCase())&&$(d.form).find('input[type="file"]').length))return!1;if(!y._trigger("beforerequest",[d]))return!0;if(y.off("beforerequest"),!y.ok())return!(!d.form||y._trigger("formsubmit",[{form:d.form}]));if(t=new Url(d.url,!0),m=new Url(document.location.href,!0),t.scheme!=m.scheme&&(t.scheme=m.scheme,console.warn("Protocol mismatch: "+t.url())),_=null,d.form){if(!y._trigger("formsubmit",[{form:d.form}]))return!0;"get"==d.form.method.toLowerCase()?(t.query=Url.serializeForm(d.form),d.form=null):_=Url.serializeForm(d.form)}if(!y._trigger("router",[t,d]))return d.history&&w.pushState({noCache:y.page_no_cache},document.title,t.url()),!0;if(c.test(t.path))return!1;if(t.domain!=m.domain){if(m.parseDomain(),0<(a=t.parseDomain()).sub_domains.length&&(r=a.sub_domains[a.sub_domains.length-1],u.test(r.toLowerCase())||r.length<=2))return!1;if(a.base_domain!=m.domain)return!1;o="/"==t.path.replace(/\/+/g,"/")||!t.path.length,/\.grp\./i.test(t.domain)?(o&&(t.path="/comm/comm/show",t.query={}),t.query.address=a.sub_domains[0].replace(/-/g,"_")):(o&&(t.path="/mysite/",t.query={}),t.query.name=a.sub_domain.replace(/-/g,"_")),t.domain=m.domain}return h=function(e){y.setRefresh(!1),y._trigger("requestend",[e]),e?y._proccessInternalCb(location.hash.substr(1)):(y._trigger("shutdown"),y._resetHandlers()),Spaces.clearErrors()},g=function(){y._trigger("pageloaded")},v=t.hash,n=d.history?new Url(w.cur_url):new Url(w.old_url),!d.form&&(0<n.hash.length||0<t.hash.length)&&t.isSame(n)?(y._trigger("requeststart"),h(!0),y.page_no_cache&&w.updateState(function(e){e.noCache=!0}),!!d.from_history):!y.disabled&&(delete t.query.sid,f=t.url(),t.hash="",b=t.url(),!(d.app&&Device.android_app&&SpacesApp.exec("go",d.app))&&(i=y.pages_id[b],S=d.from_history&&i?i.rnd:(new Date).getTime(),d.state&&d.state.noCache&&(S=(new Date).getTime()),y.pages_id[b]||(y.pages_id[b]={}),y.pages_id[b].time=(new Date).getTime(),y.pages_id[b].rnd=S,d.state&&d.state.post_data&&(_=d.state.post_data,p=d.state.multipart),k=cookie.get("sid"),s=function(r){var e,t,a,o,n,i,s,l,c,u;if(r.reklama_id&&r.reklama_id!=Spaces.params.ac&&($("."+Spaces.params.ac).removeClass(Spaces.params.ac).addClass(r.reklama_id),$.each(E,function(e,t){$("."+Spaces.params.ac+e).removeClass(Spaces.params.ac+e).addClass(r.reklama_id+e)}),SPACES_PARAMS.ac=r.reklama_id,Spaces.params.ac=r.reklama_id),r.app&&Device.android_app)return SpacesApp.exec("go",r.app),!1;if(r.http_error===undefined){if(e=!1,r.copy_link_id&&(e=d.from_history&&y.last.link_id>r.copy_link_id&&y.last.sid==k,y.last.sid=k,y.last.link_id<r.copy_link_id&&(y.last.link_id=r.copy_link_id),Spaces.params.link_id=r.copy_link_id),t=$(window).scrollTop(),h(),window.Sidebar&&Sidebar.toggle(!1),e||(r.newSettings&&y.updateSettings(r.newSettings),r.refreshWidgets&&(y.current_tab_widgets_updated=!0,y.updateWidgets(r.refreshWidgets,!0)),r.friends&&($("#friends_cnt").text(r.friends[0]).parent().toggle(0<r.friends[0]),$("#friends_cake").toggle(0<r.friends[1]))),r.redirect){for(a=new Url(r.redirect.replace(/&amp;/gi,"&")).merge(new Url(f)),console.error("redirect: "+a.url(),"("+r.redirect+")"),o=0;o<r.cookie.length;++o)document.cookie=r.cookie[o];return a.domain==location.hostname.toLowerCase()&&r.user_id==y.user_id&&y.loadPage({url:a.url()})||location.assign(html_unwrap(r.redirect)),void g()}if(r.revision&&(r.revision[1]>SPACES_REV&&(console.log("new ajax rev: "+r.revision[1]),y.disable(!0)),r.revision[0]!=T&&(T=r.revision[0],y.refreshWidgets(Spaces.WIDGETS.CSS))),$("#main_search_input, #header_elements .js-search__input").val("").blur(),r.refresh){if(a=new Url(r.refresh.link),r.refresh.link=r.refresh.link.replace(/&amp;/gi,"&"),a.domain!=m.domain)return location.assign("/?redirect="+encodeURIComponent(r.refresh.link)+"&xyz=1"),void g();y.setRefresh(r.refresh.link,r.refresh.time)}if(r.user_id!=y.user_id)return location.assign(f),void g();for(i in d.from_history?y.prev_url&&(y.pages_id[y.prev_url].forms=D(document.getElementById("main_content"))):(y.pages_id[b]&&delete y.pages_id[b].forms,w.updateState(function(e){e.scroll=t,e.forms=D(document.getElementById("main_content"))})),d.history&&w.pushState({rnd:S,post_data:_,multipart:p},r.title,f),y.prev_url=b,n=(new Date).getTime(),y.pages_id){if(y.pages_id[i].time+y.page_cache_time>=n)break;delete y.pages_id[i]}++x,$("#main").off(),$("body").off(".oneRequest"),$(window).off(".oneRequest"),document.title=r.title,r.css_files&&Loader.loadCSS(r.css_files,!0),s=!!r.main_footer,l={">debug":"debug",sidebar:"widgets.sidebar",section_tabs:"widgets.section_tabs",location_header:"location",location_footer:r.locationBottom?"locationBottom":"location",coins_gift:"coins_gift",sharings:"shareButtons",page_counters:"counters",index_counters:"index_counters",main_footer:"main_footer",top_info_block:"top_info_block",moder_block:"moder_block",lang_switcher:"widgets.lang_switcher",apps_widget:"apps_widget"},$.each(E,function(e,t){if(r.refreshWidgets){if(r.refreshWidgets[Spaces.WIDGETS.RIGHTBAR]&&"rightbar_reklama"==t)return;if((r.refreshWidgets[Spaces.SIDEBAR.SIDEBAR]||find_var(r,"widgets.sidebar"))&&"sidebar_reklama"==t)return}l["."+Spaces.params.ac+e]=t}),each(l,function(e,t){var a=e&&find_var(r,e);(">"!=t[0]||(t=t.substr(1),a))&&$("."==t[0]?t:"#"+t).fastHtml(!1!==e&&a||"")}),c=$("#main_content").fastHtml('<div id="main">'+(r.game_motivator?r.game_motivator:"")+r.content+"</div>"),$("#main_page_footer, #bottom_tools_main, #main_page_footer, #index_counters").visible(s),$("#navi_footer_wrap, #bottom_tools_wrap").visible(!s),$("#version_selector").visible(r.showVersionSelector),require("notif",function(){r.notifications&&!e&&Spaces.notifications.pushNotifications(r.notifications)}),r.topCounters&&!e&&(u=r.topCounters,require("notif",function(){Spaces.notifications.updateCounter(Notifications.COUNTER.MAIL,u.mail_new,{blink:!1}).updateCounter(Notifications.COUNTER.LENTA,u.lenta,{blink:!1}).updateCounter(Notifications.COUNTER.JOURNAL,u.journal_imp+u.journal,{important:0<u.journal_imp,blink:!1})})),setTimeout(function(){var e;d.state&&d.state.forms&&(e=d.state.forms),y.pages_id[b]&&y.pages_id[b].forms&&(e=y.pages_id[b].forms),e&&C(c[0],e),r.copy_link_id&&($("#bottom_tools_wrap, #navi_footer_wrap, #header_elements, #page_sidebar, #bottom_tools_main, #page_rightbar").find("a").each(function(){this.href=this.href.replace(/(link_id=)(\d+)/gi,"$1"+r.copy_link_id)}),$("#page_sidebar, #page_rightbar").find('input[name="link_id"], input[name="Link_id"]').val(r.copy_link_id)),$("#copy_url").visible(!!r.copy_link_show),!d.scroll||d.state&&d.state.scroll||y.scrollDocument(v),setTimeout(Spaces.makeZbs,1e3),g()},0),d.state&&d.state.scroll&&y.scrollDocument(d.state.scroll)}else y.showLoadingError(Spaces.getHttpError(r.http_error),d)},"firefox"==Device.browser&&"desktop"!=Device.type&&(l=s,s=function(e){!d.scroll||d.state&&d.state.scroll||y.scrollDocument(),setTimeout(function(){l(e)},0)}),y._trigger("requeststart"),y.request(S,t,_,s,function(e){g(e.manual),y._trigger("requestend"),e.manual||(y.scrollDocument(),y.showLoadingError(e.error,d))},{multipart:p}),!0))},request:function(e,t,a,r,o,n){var i,s,l=this;n=$.extend({multipart:!1},n),Spaces.clearError("ajax_error"),l.opts.loading_indicator&&l.showLoading(),++l.active_reqs,i=function(e){--l.active_reqs,l.opts.loading_indicator&&l.hideLoading(),r&&r(e)},l.opts.iframe_transport?(t.path="/xhr"+e+t.path,d.setCallbacks({success:i,error:function(e){--l.active_reqs,l.opts.loading_indicator&&l.hideLoading(),o&&o({manual:!1,error:Spaces.getHttpError(e?-500:0)})},always:function(){}}),a?d.post(t.url(!0),a,n.multipart):d.get(t.url(!0))):(t.path="/ajax"+e+t.path,s=window.FormData&&n.multipart,l.cancel(),l._last_xhr_request=$.ajax({url:t.url(!0),processData:!1,contentType:!s&&"application/x-www-form-urlencoded; charset=UTF-8",data:s?function(e){var t,a,r,o=new window.FormData;for(t in e)if(Object.prototype.hasOwnProperty.call(e,t))if(e[t]instanceof Array)for(a=0,r=e[t].length;a<r;++a)o.append(t,e[t][a]);else o.append(t,e[t]);return o}(a):Url.buildQuery(a),method:a?"POST":"GET",dataType:"json",cache:!0}).success(i).fail(function(e){--l.active_reqs,l.opts.loading_indicator&&l.hideLoading(),o&&o({xhr:e,manual:e.__manual_abort,error:Spaces.getHttpError(200==e.status?-500:e.status)})}).always(function(){l._last_xhr_request=null}))},cancel:function(){var e=this;e.opts.iframe_transport?d.abort():e._last_xhr_request&&4!=e._last_xhr_request.readyState&&(e._last_xhr_request.__manual_abort=!0,e._last_xhr_request.abort())},getRequestId:function(){return x},disable:function(e){this.disabled=e},reload:function(){page_loader.ok()&&page_loader.loadPage({url:location.href,state:w.state})||location.reload()},showLoadingError:function(e,t){var a=this;Spaces.showError(e,"ajax_error",{onRetry:function(){a.loadPage(t)}})},documentAutoScroller:function(e,t,a){var r,o,n,i,s=this,l=$("html, body"),c=$(window),u=(new Date).getTime(),d=0,p="object"!=typeof e&&$.isNumeric(e)?parseInt(e):null;a=a||3e4,o="touchmove.auto_scroller touchstart.auto_scroller keydown.auto_scroller click.auto_scroller MozMousePixelScroll.auto_scroller mousewheel.auto_scroller wheel.auto_scroller scroll.auto_scroller",n=function(e){e&&!e.originalEvent||e&&"scroll"==e.type&&e.originalEvent&&d==c.scrollTop()||(clearInterval(r),r=null,c.off(".auto_scroller"))},r=setInterval(i=function(){l.scrollTop(null!==p?p:parseInt(e.offset().top)),d=c.scrollTop(),(new Date).getTime()-u>a&&n()},t=t||200),i(),c.on(o,n),s.onRequestStart("auto_scroller",n)},scrollDocument:function(e){var t,a=this,r=parseInt(e);if(isNaN(r)&&e&&("object"==typeof e||0<e.length)){if("string"==typeof e&&"/"==e.substr(0,1))return;try{if(0<(t="object"==typeof e?$(e):$("#"+e+', a[name="'+e+'"]')).length)return void a.documentAutoScroller(t,200,3e4)}catch(o){console.error(o.toString())}}"firefox"==Device.browser?($("html, body").scrollTop(r||0),setTimeout(function(){$("html, body").scrollTop(r||0)},15)):$("html, body").scrollTop(r||0)},refreshWidgets:function(e,t){var a=this;e&&Spaces.api("neoapi/common.refreshWidget",{widgets:e},function(e){0==e.code&&e.widgets&&(a.updateWidgets(e.widgets),t&&t())})},updateWidgets:function(e,t){var a,r,o,n,i,s,l,c,u,d,p={},f={};for(o in p[Spaces.WIDGETS.FOOTER]="navi_footer_wrap",p[Spaces.WIDGETS.HEADER]="header_elements",p[Spaces.WIDGETS.SIDEBAR]="page_sidebar",p[Spaces.WIDGETS.RIGHTBAR]="page_rightbar",f[Spaces.WIDGETS.FOOTER]="footer",f[Spaces.WIDGETS.HEADER]="header",f[Spaces.WIDGETS.SIDEBAR]="sidebar",f[Spaces.WIDGETS.CSS]="css",f[Spaces.WIDGETS.RIGHTBAR]="rightbar",window.Sidebar&&Sidebar.toggle(!1),a=Spaces.params.avatar,r={},e)r[o]=!0,console.error("Обновляем: "+f[o]),p[o]!==undefined?(o==Spaces.WIDGETS.FOOTER&&Spaces.footer&&Spaces.footer.update(),$("#"+p[o]).fastHtml(e[o]),o==Spaces.WIDGETS.HEADER&&(Loader.loaded("sidebar",function(){Sidebar.init()}),Loader.loaded("clock",function(){Spaces.Clock.check()})),o==Spaces.WIDGETS.SIDEBAR&&(Spaces.core.check(),a!=Spaces.params.avatar&&Spaces.view.updateAvatars())):o==Spaces.WIDGETS.CSS&&(n=$("head"),m&&(n.find("link[data-main-css]").each(function(e,t){var a=$(this);a.data("loading")&&a.prop("disabled",!0).remove()}),clearTimeout(m)),i=n.find("link[data-main-css]"),s=$("<div>").html(e[o]).find("link[data-main-css]").data("loading",!0),i.length!=s.length?(i.first().before(s),i.prop("disabled",!0).remove()):(l=Date.now(),c=s.map(function(e,t){if(s[e].href!=i[e].href)return $(i[e]).after(s[e]),{old:i[e],cur:s[e],secure:0<=s[e].href.indexOf("://"+location.host+"/")}}),u=1e3,c.length&&(m=setTimeout(d=function(){var o=[],n=Date.now()-l;$.each(c,function(e,t){var a=!1;if(t.secure&&"sheet"in t.cur)try{t.cur.sheet&&"cssRules"in t.cur.sheet&&(a=!t.cur.sheet.cssRules||0<t.cur.sheet.cssRules.length)}catch(r){a=6e4<=n}else a=2e4<=n;a?($(t.cur).data("loading",!1),t.old.disabled=!0,$(t.old).remove()):o.push(t)}),m=!1,(c=o).length&&(m=setTimeout(d,n<=8e3?u:2*u))},u))));$("body").trigger("spUpdatePart",r)},updateSettings:function(e){var t,a;for(t in e)a=e[t],t==Spaces.SettingsTypes.AVATAR?(Spaces.params.avatar=a,Spaces.view.updateAvatars()):t==Spaces.SettingsTypes.USER_NAME?Spaces.params.name=a:t==Spaces.SettingsTypes.FORM_SUBMIT_KEY?Spaces.params.form_submit_key=a?"ENTER":"CTRL_ENTER":t==Spaces.SettingsTypes.SOUND_NOTIFY_BLOCK&&(Spaces.params.play_sound=!a)},back:function(){return history.back(),!1},showLoading:function(){var e,t=this;t.active_reqs||(e=$("#main_shadow"),$("#ajax_loader").css({top:0,left:e.offset().left,width:e.outerWidth()}).visible(!0))},hideLoading:function(){this.active_reqs||$("#ajax_loader").visible(!1)},isJSC:function(){return!!this.ok()&&!!location.hash.substr(1).match(/^([^\/]+)\/?(.*?)$/i)},onJSC:function(e,t,a){return this.ok()?this.on("js_cb_"+e,"js_cb_"+e,t,a)._proccessInternalCb(location.hash.substr(1),e):this},setJSC:function(e,t,a){if(this.ok()){var r=new Url(location.href),o=location.hash.substr(1);e?(r.hash=e+"/"+t,w[a?"replaceState":"pushState"](null,null,r.url())):o.match(/^([^\/]+)\/?(.*?)$/i)&&(r.hash="",w.replaceState(null,null,r.url()))}},_proccessInternalCb:function(e,t){if(this.ok()){var a;new Url(location.href);e&&(!(a=e.match(/^([^\/]+)\/?(.*?)$/i))||t&&t!=a[1]||this._trigger("js_cb_"+a[1],[a[2]]))}},noCache:function(e){var t=this;if(t.ok())return t.page_no_cache=e===undefined||!!e,w.updateState(function(e){e.noCache=t.page_no_cache}),t},one:function(e,t){return this.on(e,"__signle__",t,!0)},push:function(e,t){return this.on(e,"shd"+ ++this._rnd,t,!1)},router:function(e,t){return this.on("router","router"+ ++this._rnd,e,{persistOnRequest:!t,persist:!!t})},on:function(e,t,a,r){return r=extend({persist:"boolean"==typeof r&&r,persistOnRequest:!1},r),a?(this.callbacks[e]=this.callbacks[e]||{},this.callbacks[e][t]={func:a,opts:r},this):this.off(e,t)},off:function(e,t){return t&&this.callbacks[e]?delete this.callbacks[e][t]:this.callbacks[e]={},this},_trigger:function(e,t){var a,r,o=this,n=!1;if(!o.callbacks[e])return!0;for(a in o.callbacks[e]){if((r=o.callbacks[e][a]).func)try{!1===r.func.apply(o,t)&&(n=!0)}catch(i){console.error("Handler ("+e+", "+a+") error:",i.stack?"\n"+i.stack:i)}r.func&&(r.opts.persist||r.opts.persistOnRequest)||o.off(e,a)}return!n},_resetHandlers:function(){var e,t,a=this;for(e in a.callbacks)for(t in a.callbacks[e])a.callbacks[e][t].opts.persistOnRequest&&a.off(e,t)},ok:function(){var e=this;return"_ok"in e||(e._ok=cookie.enabled()&&history.pushState&&!/ajaxify=0/i.test(document.cookie)&&"operamini"!=Device.browser&&!Spaces.params.no_ajaxify,Device.android_app&&Device.webkit()<=533.1&&(e._ok=!1),Device.android_app&&window.SpacesApp.exec("ajaxify",{enable:e._ok})),!e.invalid_page&&e._ok}}),w.init(),window.PageLoader=e,window.page_loader=new e});