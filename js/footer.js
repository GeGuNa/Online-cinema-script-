define("footer","init",function(){function s(e){var o=$("#footer");o.find(".footer__link_edit").find(".form-toggle__wrap").toggleClass("form-toggle__wrap_off",!e),o.toggleClass("footer_text-hide",!e)}function i(){if(!o&&0==k.count){if(k.payload){!function(e){var o,t,i,n,a,r=$("#footer"),_=r.find(".footer__links-wrapper"),l=_.hasClass("loaded");Loader.loaded("footer_deps",function(){_.sortableItems(!1)}),$("#footer_more_link").remove(),o=_.find(".footer__link-wrapper"),l&&e.links.length==o.length||(o.remove(),o=$([])),t=o.length,"hide_text"in e&&s(!e.hide_text),"moder_switch_state"in e&&r.find(".footer__link_moder").find(".form-toggle__wrap").toggleClass("form-toggle__wrap_off",!e.moder_switch_state);for(i=e.links.length;0<i--;)n=e.links[i],a=i,0<t?o[a].getAttribute("data-id")==n.id?$(o[a]).toggleClass("footer__link_on",0<n.state).toggleClass("footer__link_off",n.state<0):$(o[a]).replaceWith(m.link(n)):_.prepend(m.link(n));l||_.addClass("loaded"),c?Loader.loaded("footer_deps",function(){_.sortableItems({defaultStyle:!1,autoWidth:!1,autoHeight:!1,moveDir:"both",customPlaceholder:d})}):f("update")}(k.payload);for(var e=0;e<k.callbacks.length;++e)k.callbacks[e]()}k.callbacks=[],k.payload=null}}function r(e,o){++k.count,o&&k.callbacks.push(o),(e=e||{}).Ti=n;var t=Date.now();Spaces.api("neoapi/settings.navi",e,function(e){--k.count,0==e.code&&e.time>=k.time&&(e.time!=k.time||t>k.rtime)&&(k.payload=e,k.rtime=t,k.time=e.time),i()},{onError:function(){--k.count,i()}})}function f(i){$(function(){var e,o,t=$("#footer");c&&$("#footer_settings_link").click(),$("#footer_more_link").remove(),e=t.find(".footer__link_on"),o=$(m.link({state:1,id:-1,link_addr:"#",type_name:"more",full_name:L("Ещё")})).attr("id","footer_more_link"),"operamini"==Device.browser&&o.click(function(){}),0<e.length?$(e[Math.min(a-1,e.length-1)])[e.length>=a?"before":"after"](o):$("#footer").find(".footer__links-wrapper").prepend(o),_("boolean"==typeof i?i:p)})}function _(e){var o,t=$("#footer"),i=$("#footer_more_link"),n=t.find(".footer__link_on:not(#footer_more_link)");if(e===undefined&&(e=!i.hasClass("footer__link_active")),p=e)$("#footer_settings").show(),i.addClass("footer__link_active"),n.show();else for(i.removeClass("footer__link_active"),$("#footer_settings").hide(),o=a-1;o<n.length;++o)$(n[o]).hide()}var d,a=10,l="desktop"!=Device.type,o=!1,c=!1,p=!1,n=Date.now(),k={payload:null,count:0,time:0,rtime:0,callbacks:[]},m={link:function(e){var o="home"==e.type_name?'<img src="'+Spaces.params.avatar+'" alt="" />':"",t=e.link_addr.replace(/link_id=\d*/g,"link_id="+Spaces.params.link_id),i='<div class="footer__link-wrapper footer__link_'+(0<e.state?"on":"off")+(e.id<0?" footer__link_more":"")+'" data-id="'+e.id+'"><a href="'+t+'" class="footer__link"'+(e.placeholder?' style="visibility: hidden; opacity: 0"':"")+'><div class="footer__bg"></div><div class="footer__image">'+(o?'<div class="footer__avatar js-my_avatar">'+o+"</div>":'<div class="f__ico f__ico_'+e.type_name+'"></div>')+'</div><div class="footer__name">'+e.full_name+"</div></a></div>";return i}};$(function(){d=$(m.link({state:1,id:-1,link_addr:"#",type_name:"placeholder",full_name:"&nbsp;",placeholder:!0}));var a=$("#navi_footer_wrap");a.on("click",".footer_edit .footer__link_on, .footer_edit .footer__link_off",function(e){e.preventDefault();var o=$(this);r({CK:null,L:o.data("id"),S:o.hasClass("footer__link_on")?0:1},!1),o.toggleClass("footer__link_on").toggleClass("footer__link_off")}).on("click","#footer_more_link",function(e){e.preventDefault(),_()}),"operamini"!=Device.browser&&a.on("click","#footer_settings_link",function(e){e.preventDefault();var o=$(this),t=$("#footer"),i=$("#footer_settings_link"),n=$("#footer_settings_link .footer__name-text");o.data("process")||(o.hasClass("footer__link_active")?(c=!1,t.find(".footer__links-wrapper").sortableItems(!1),o.removeClass("footer__link_active"),t.addClass("footer_read").removeClass("footer_edit"),t.find(".footer__link_moder").show(),t.find(".footer__link_colors, .footer__link_edit").hide(),f(),n.text(L("Настроить меню"))):(c=!0,i.find(".f__ico_settings").removeClass("f__ico_settings").addClass("f__ico_spinner"),o.data("process",!0),require("footer_deps",function(){r({},function(){o.data("process",!1),i.find(".f__ico_spinner").removeClass("f__ico_spinner").addClass("f__ico_settings"),o.addClass("footer__link_active"),t.removeClass("footer_read").addClass("footer_edit"),l||t.addClass("footer_shake"),$("html, body").scrollTop(a.offset().top),_(!0),n.text(L("Сохранить настройки")),t.find(".footer__link_moder").hide(),t.find(".footer__link_colors, .footer__link_edit").show()})})))}).on("click",".footer__link_edit",function(e){e.preventDefault();var o=!$(this).find(".form-toggle__wrap").hasClass("form-toggle__wrap_off");s(!o),r({CK:null,Ht:o?1:0},!1)}).on("sortableEnd",function(e){o=!1,0!=e.offset&&r({CK:null,L:e.element.data("id"),M:e.offset},!1)}).on("sortableStart",function(){o=!0}),pushstream&&pushstream.addMessageHandler("footer",function(e){e.act==Spaces.LongPollingTypes.REFRESH_WIDGETS&&e.widgets&Spaces.WIDGETS.FOOTER&&e.tab_id!=n&&(e.links?function(e){if(e.links){var o=e._e_tag/1e3;o>=k.time&&(k.payload=e,k.rtime=o,k.time=o),i()}}(e):r({}))}),page_loader.on("shutdown","footer",function(){Spaces.footer.update(!1)},!0),f(!1)}),window.Spaces.footer={toggle:_,update:f}});