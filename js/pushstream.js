!function(a,c,t){"use strict";var r,n,s,i,u,o,h,l,p,d,m,f,g,_,y,S,v,C,b,T,w,P,O,I,x,E,A,k,M,N,j,L,R,D,U;a.PushStream||(n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i=function(t){return(t<10?"0":"")+t},(r={}).dateToUTCString=function(t){var e=i(t.getUTCHours())+":"+i(t.getUTCMinutes())+":"+i(t.getUTCSeconds());return n[t.getUTCDay()]+", "+i(t.getUTCDate())+" "+s[t.getUTCMonth()]+" "+t.getUTCFullYear()+" "+e+" GMT"},u=function(){var t,e,n,s=arguments[0]||{};for(t=0;t<arguments.length;t++)for(n in e=arguments[t])e.hasOwnProperty&&!e.hasOwnProperty(n)||(s[n]=e[n]);return s},o=/^[\],:{}\s]*$/,h=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,l=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,p=/(?:^|:|,)(?:\s*\[)+/g,d=function(t){return t.replace(/^\s*/,"").replace(/\s*$/,"")},r.parseJSON=function(t){if(!t||!v(t))return null;if(t=d(t),a.JSON&&a.JSON.parse)try{return a.JSON.parse(t)}catch(e){throw"Invalid JSON: "+t}if(o.test(t.replace(h,"@").replace(l,"]").replace(p,"")))return Function("return "+t)();throw"Invalid JSON: "+t},m=function(t){var e={};return e[t.tagArgument]="",e[t.timeArgument]="",e[t.eventIdArgument]="",t.messagesControlByArgument&&(e[t.tagArgument]=+t._etag,t._lastModified?e[t.timeArgument]=t._lastModified:t._lastEventId&&(e[t.eventIdArgument]=t._lastEventId)),e},f=function(){return(new Date).getTime()},g=function(){return{_:f()}},_=function(t){var e,n=t;if("object"==typeof t){for(e in n="",t)t.hasOwnProperty&&!t.hasOwnProperty(e)||(n+="&"+e+"="+a.escape(t[e]));n=n.substring(1)}return n||""},y=function(t,e){return t+(t.indexOf("?")<0?"?":"&")+_(e)},S=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},v=function(t){return"[object String]"===Object.prototype.toString.call(t)},C=function(t){return"[object Date]"===Object.prototype.toString.call(t)},b={_getXHRObject:function(t){var e=!1;if(t){try{e=new a.XDomainRequest}catch(n){}if(e)return e}try{e=new a.XMLHttpRequest}catch(s){try{e=new a.ActiveXObject("Msxml2.XMLHTTP")}catch(i){try{e=new a.ActiveXObject("Microsoft.XMLHTTP")}catch(r){e=!1}}}return e},_send:function(e,t){var n,s,i,r,o;if((e=e||{}).timeout=e.timeout||3e4,(n=b._getXHRObject(e.crossDomain))&&e.url)return b.clear(e),e.xhr=n,a.XDomainRequest&&n instanceof a.XDomainRequest?(n.onload=function(){e.afterReceive&&e.afterReceive(n),e.success&&e.success(n.responseText)},n.onerror=n.ontimeout=function(){e.afterReceive&&e.afterReceive(n),e.error&&e.error(n.status)}):n.onreadystatechange=function(){4===n.readyState&&(b.clear(e),e.afterReceive&&e.afterReceive(n),200===n.status?e.success&&e.success(n.responseText):e.error&&e.error(n.status))},e.beforeOpen&&e.beforeOpen(n),s={},i=null,r="GET",t?(i=_(e.data),r="POST"):s=e.data||{},n.open(r,y(e.url,u({},s,g())),!0),e.beforeSend&&e.beforeSend(n),o=function(){b.clear(e);try{n.abort()}catch(t){}e.error(304)},t?n.setRequestHeader&&(n.setRequestHeader("Accept","application/json"),n.setRequestHeader("Content-type","application/x-www-form-urlencoded")):e.timeoutId=a.setTimeout(o,e.timeout+2e3),n.send(i),n},_clear_xhr:function(t){t&&(t.onreadystatechange=null)},_clear_script:function(t){t&&(t.onerror=t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t))},_clear_timeout:function(t){t.timeoutId=k(t.timeoutId)},_clear_jsonp:function(t){var e=t.data.callback;e&&(a[e]=function(){a[e]=null})},clear:function(t){b._clear_timeout(t),b._clear_jsonp(t),b._clear_script(c.getElementById(t.scriptId)),b._clear_xhr(t.xhr)},jsonp:function(e){var t,n,s,i,r,o;return e.timeout=e.timeout||3e4,b.clear(e),t=c.head||c.getElementsByTagName("head")[0],n=c.createElement("script"),s=f(),i=function(){b.clear(e);var t=f();e.error(t-s>e.timeout/2?304:403)},r=function(){b.clear(e),e.load()},o=function(){e.afterSuccess=!0,e.success.apply(null,arguments)},n.onerror=i,n.onload=n.onreadystatechange=function(t){n.readyState&&!/loaded|complete/.test(n.readyState)||(e.afterSuccess?r():i())},e.beforeOpen&&e.beforeOpen({}),e.beforeSend&&e.beforeSend({}),e.timeoutId=a.setTimeout(i,e.timeout+2e3),e.scriptId=e.scriptId||f(),e.afterSuccess=null,e.data.callback=e.scriptId+"_onmessage_"+f(),a[e.data.callback]=o,n.setAttribute("src",y(e.url,u({},e.data,g()))),n.setAttribute("async","async"),n.setAttribute("id",e.scriptId),t.insertBefore(n,t.firstChild),e},load:function(t){return b._send(t,!1)},post:function(t){return b._send(t,!0)}},T=function(t){return t?a.escape(t):""},w=function(t){return t?a.unescape(t):""},r.parseMessage=function(t,e){var n=t;return v(t)&&(n=r.parseJSON(t)),{id:n[e.jsonIdKey],channel:n[e.jsonChannelKey],text:v(n[e.jsonTextKey])?w(n[e.jsonTextKey]):n[e.jsonTextKey],tag:n[e.jsonTagKey],time:n[e.jsonTimeKey],eventid:n[e.jsonEventIdKey]||""}},P=function(t){return t.backtrack?".b"+ +t.backtrack:""},O=function(t,e){var n,s="";for(n in t)t.hasOwnProperty&&!t.hasOwnProperty(n)||(s+="/"+n+(e?P(t[n]):""));return s},I=function(t,e,n,s){var i,r,o=t.wrapper.type===L.TYPE,a=t.useSSL,c=E(a,t.port),h=o?a?"wss://":"ws://":a?"https://":"http://";return h+=t.host,h+=c?":"+c:"",h+=e,i=O(t.channels,s),t.channelsByArgument?((r={})[t.channelsArgument]=i.substring(1),n=u({},n,r)):h+=i,y(h,n)},x=function(t){var e=E(t.useSSL,t.port),n=t.useSSL?"https://":"http://";return n+=t.host,n+=e?":"+e:"",n+=t.urlPrefixPublisher,n+="?id="+O(t.channels,!1)},r.extract_xss_domain=function(t){var e,n;return t.match(/^(\d{1,3}\.){3}\d{1,3}$/)?t:(e=t.split("."),n=Math.max(e.length-1,t.match(/(\w{4,}\.\w{2}|\.\w{3,})$/)?2:3),e.slice(-1*n).join("."))},E=function(t,e){return e=+(e||(t?443:80)),!t&&80===e||t&&443===e?"":e},r.isCrossDomainUrl=function(t){var e,n,s;return!!t&&((e=c.createElement("a")).href=t,n=E("https:"===a.location.protocol,a.location.port),s=E("https:"===e.protocol,e.port),a.location.protocol!==e.protocol||a.location.hostname!==e.hostname||n!==s)},A=function(t,e){return function(){return t.apply(e,arguments)}},k=function(t){return t&&a.clearTimeout(t),null},M=function(t){var e=r.parseMessage(t.data,this.pushstream);e.tag&&(this.pushstream._etag=e.tag),e.time&&(this.pushstream._lastModified=e.time),e.eventid&&(this.pushstream._lastEventId=e.eventid),this.pushstream._onmessage(e.text,e.id,e.channel,e.eventid,!0,e.time)},N=function(){this.pushstream._onopen()},j=function(t){this._closeCurrentConnection(),this.pushstream._onerror({type:t&&("load"===t.type||"close"===t.type&&1006===t.code)||this.pushstream.readyState===U.CONNECTING?"load":"timeout"})},(L=function(t){if(!a.WebSocket&&!a.MozWebSocket)throw"WebSocket not supported";this.type=L.TYPE,this.pushstream=t,this.connection=null}).TYPE="WebSocket",L.prototype={connect:function(){var t,e;this._closeCurrentConnection(),t=u({},this.pushstream.extraParams(),g(),m(this.pushstream)),e=I(this.pushstream,this.pushstream.urlPrefixWebsocket,t,!this.pushstream._useControlArguments());try{this.connection=a.WebSocket?new a.WebSocket(e):new a.MozWebSocket(e)}catch(n){return void A(j,this)()}this.connection.onerror=A(j,this),this.connection.onclose=A(j,this),this.connection.onopen=A(N,this),this.connection.onmessage=A(M,this)},disconnect:function(){this.connection&&(this.connection.onclose=null,this._closeCurrentConnection(),this.pushstream._onclose())},_closeCurrentConnection:function(){if(this.connection){try{this.connection.close()}catch(t){}this.connection=null}},sendMessage:function(t){this.connection&&this.connection.send(t)}},(R=function(t){this.type=R.TYPE,this.pushstream=t,this.connection=null,this.opentimer=null,this.messagesQueue=[],this._linkedInternalListen=A(this._internalListen,this),this.xhrSettings={timeout:this.pushstream.timeout,data:{},url:null,success:A(this.onmessage,this),error:A(this.onerror,this),load:A(this.onload,this),beforeSend:A(this.beforeSend,this),afterReceive:A(this.afterReceive,this)}}).TYPE="LongPolling",R.prototype={connect:function(){this.messagesQueue=[],this._closeCurrentConnection(),this.urlWithBacktrack=I(this.pushstream,this.pushstream.urlPrefixLongpolling,{},!0),this.urlWithoutBacktrack=I(this.pushstream,this.pushstream.urlPrefixLongpolling,{},!1),this.xhrSettings.url=this.urlWithBacktrack,this.useJSONP=this.pushstream._crossDomain||this.pushstream.useJSONP,this.xhrSettings.scriptId="PushStreamManager_"+this.pushstream.id,this.useJSONP&&(this.pushstream.messagesControlByArgument=!0),this._listen(),this.opentimer=a.setTimeout(A(N,this),150)},_listen:function(){this._internalListenTimeout&&k(this._internalListenTimeout),this._internalListenTimeout=a.setTimeout(this._linkedInternalListen,100)},_internalListen:function(){this.pushstream._keepConnected&&(this.xhrSettings.url=this.pushstream._useControlArguments()?this.urlWithoutBacktrack:this.urlWithBacktrack,this.xhrSettings.data=u({},this.pushstream.extraParams(),this.xhrSettings.data,m(this.pushstream)),this.useJSONP?this.connection=b.jsonp(this.xhrSettings):this.connection||(this.connection=b.load(this.xhrSettings)))},disconnect:function(){this.connection&&(this._closeCurrentConnection(),this.pushstream._onclose())},_closeCurrentConnection:function(){if(this.opentimer=k(this.opentimer),this.connection){try{this.connection.abort()}catch(t){try{b.clear(this.connection)}catch(e){}}this.connection=null,this.xhrSettings.url=null}},beforeSend:function(t){this.pushstream.messagesControlByArgument||(t.setRequestHeader("If-None-Match",this.pushstream._etag),t.setRequestHeader("If-Modified-Since",this.pushstream._lastModified))},afterReceive:function(t){this.pushstream.messagesControlByArgument||(this.pushstream._etag=t.getResponseHeader("Etag"),this.pushstream._lastModified=t.getResponseHeader("Last-Modified")),this.connection=null},onerror:function(t){this._closeCurrentConnection(),this.pushstream._keepConnected&&(304===t?this._listen():this.pushstream._onerror({type:403===t||this.pushstream.readyState===U.CONNECTING?"load":"timeout"}))},onload:function(){this._listen()},onmessage:function(t){var e,n,s,i;for(this._internalListenTimeout&&k(this._internalListenTimeout),e=null,n=S(t)?t:t.replace(/\}\{/g,"}\r\n{").split("\r\n"),s=0;s<n.length;s++)n[s]&&(e=r.parseMessage(n[s],this.pushstream),this.messagesQueue.push(e),this.pushstream.messagesControlByArgument&&e.time&&(this.pushstream._etag=e.tag,this.pushstream._lastModified=e.time));for(this._listen();0<this.messagesQueue.length;)i=this.messagesQueue.shift(),this.pushstream._onmessage(i.text,i.id,i.channel,i.eventid,0===this.messagesQueue.length,i.time)}},D=[],(U=function(t){var e,n;for(t=t||{},this.id=D.push(this)-1,this.useSSL=t.useSSL||!1,this.host=t.host||a.location.hostname,this.port=+(t.port||(this.useSSL?443:80)),this.timeout=t.timeout||3e4,this.pingtimeout=t.pingtimeout||3e4,this.reconnectOnTimeoutInterval=t.reconnectOnTimeoutInterval||3e3,this.reconnectOnChannelUnavailableInterval=t.reconnectOnChannelUnavailableInterval||6e4,this.autoReconnect=!1!==t.autoReconnect,this.lastEventId=t.lastEventId||null,this.messagesPublishedAfter=t.messagesPublishedAfter,this.messagesControlByArgument=t.messagesControlByArgument||!1,this.tagArgument=t.tagArgument||"tag",this.timeArgument=t.timeArgument||"time",this.eventIdArgument=t.eventIdArgument||"eventid",this.useJSONP=t.useJSONP||!1,this._reconnecttimer=null,this._etag=0,this._lastModified=null,this._lastEventId=null,this.urlPrefixPublisher=t.urlPrefixPublisher||"/pub",this.urlPrefixStream=t.urlPrefixStream||"/sub",this.urlPrefixEventsource=t.urlPrefixEventsource||"/ev",this.urlPrefixLongpolling=t.urlPrefixLongpolling||"/lp",this.urlPrefixWebsocket=t.urlPrefixWebsocket||"/ws",this.jsonIdKey=t.jsonIdKey||"id",this.jsonChannelKey=t.jsonChannelKey||"channel",this.jsonTextKey=t.jsonTextKey||"text",this.jsonTagKey=t.jsonTagKey||"tag",this.jsonTimeKey=t.jsonTimeKey||"time",this.jsonEventIdKey=t.jsonEventIdKey||"eventid",this.modes=(t.modes||"eventsource|websocket|stream|longpolling").split("|"),this.wrappers=[],this.wrapper=null,this.onchanneldeleted=t.onchanneldeleted||null,this.onmessage=t.onmessage||null,this.onerror=t.onerror||null,this.onstatuschange=t.onstatuschange||null,this.extraParams=t.extraParams||function(){return{}},this.channels={},this.channelsCount=0,this.channelsByArgument=t.channelsByArgument||!1,this.channelsArgument=t.channelsArgument||"channels",this._crossDomain=r.isCrossDomainUrl(x(this)),e=0;e<this.modes.length;e++)try{switch(n=null,this.modes[e]){case"websocket":n=new L(this);break;case"longpolling":n=new R(this)}this.wrappers[this.wrappers.length]=n}catch(s){}this.readyState=0}).LOG_LEVEL="error",U.LOG_OUTPUT_ELEMENT_ID="Log4jsLogOutput",U.CLOSED=0,U.CONNECTING=1,U.OPEN=2,U.prototype={addChannel:function(t,e){if(T(t)!==t)throw"Invalid channel name! Channel has to be a set of [a-zA-Z0-9]";if("undefined"!=typeof this.channels[t])throw"Cannot add channel "+t+": already subscribed";e=e||{},this.channels[t]=e,this.channelsCount++,this.readyState!==U.CLOSED&&this.connect()},removeChannel:function(t){this.channels[t]&&(delete this.channels[t],this.channelsCount--)},removeAllChannels:function(){this.channels={},this.channelsCount=0},_setState:function(t){this.readyState!==t&&(this.readyState=t,this.onstatuschange&&this.onstatuschange(this.readyState))},connect:function(){var t,e,n;if(!this.host)throw"PushStream host not specified";if(isNaN(this.port))throw"PushStream port not specified";if(!this.channelsCount)throw"No channels specified";if(0===this.wrappers.length)throw"No available support for this browser";if(this._keepConnected=!0,this._lastUsedMode=0,t=c.cookie.match(/lpm=([^\s;]+)/))for(n in e=decodeURIComponent(t[1]),this.wrappers)if(this.wrappers[n].type==e){this._lastUsedMode=n;break}this._connect()},disconnect:function(){this._keepConnected=!1,this._disconnect(),this._setState(U.CLOSED)},_useControlArguments:function(){return this.messagesControlByArgument&&(null!==this._lastModified||null!==this._lastEventId)},_connect:function(){var t,e;null===this._lastEventId&&(this._lastEventId=this.lastEventId),null===this._lastModified&&(t=this.messagesPublishedAfter,C(t)||(0<(e=+this.messagesPublishedAfter)?(t=new Date).setTime(t.getTime()-1e3*e):e<0&&(t=new Date(0))),C(t)&&(this._lastModified=r.dateToUTCString(t))),this._disconnect(),this._setState(U.CONNECTING),this.wrapper=this.wrappers[this._lastUsedMode++%this.wrappers.length];try{this.wrapper.connect()}catch(n){this.wrapper&&this.wrapper.disconnect()}},_disconnect:function(){this._reconnecttimer=k(this._reconnecttimer),this.wrapper&&this.wrapper.disconnect()},_onopen:function(){this._reconnecttimer=k(this._reconnecttimer),this._setState(U.OPEN),0<this._lastUsedMode&&(this._lastUsedMode--,-1==c.cookie.indexOf("hws=1")&&this.wrapper.type!=L.TYPE&&(c.cookie="lpm="+encodeURIComponent(this.wrapper.type)+"; path=/; domain=."+base_domain()+"; expires="+new Date(2038,1,1).toUTCString())),this.wrapper.type==L.TYPE&&(c.cookie="hws=1; path=/; domain=."+base_domain()+"; expires="+new Date(2038,1,1).toUTCString())},_onclose:function(){this._reconnecttimer=k(this._reconnecttimer),this._setState(U.CLOSED),this._reconnect(this.reconnectOnTimeoutInterval)},_onmessage:function(t,e,n,s,i,r){-2===e?this.onchanneldeleted&&this.onchanneldeleted(n):0<e&&this.onmessage&&this.onmessage(t,e,n,s,i,r)},_onerror:function(t){this._setState(U.CLOSED),this._reconnect("timeout"===t.type?this.reconnectOnTimeoutInterval:this.reconnectOnChannelUnavailableInterval),this.onerror&&this.onerror(t)},_reconnect:function(t){this.autoReconnect&&this._keepConnected&&!this._reconnecttimer&&this.readyState!==U.CONNECTING&&(this._reconnecttimer=a.setTimeout(A(this._connect,this),t))},sendMessage:function(t,e,n){t=T(t),this.wrapper.type===L.TYPE?(this.wrapper.sendMessage(t),e&&e()):b.post({url:x(this),data:t,success:e,error:n,crossDomain:this._crossDomain})}},U.sendMessage=function(t,e,n,s){b.post({url:t,data:T(e),success:n,error:s})},U.register=function(t){var e=t.window.location.href.match(/streamid=([0-9]*)&?/);e[1]&&D[e[1]]&&D[e[1]].wrapper.register(t)},U.unload=function(){for(var t=0;t<D.length;t++)try{D[t].disconnect()}catch(e){}},a.PushStream=U,a.PushStreamManager=D,a.attachEvent&&a.attachEvent("onunload",U.unload),a.addEventListener&&a.addEventListener.call(a,"unload",U.unload,!1))}(window,document);