define("files_uploader","init",function(){var u,_,n,c,m,f,t,g={light:"progress-item__runner_light",pctDone:"progress-item__num_fin"},v={fileItemLite:function(e){return'<div id="upload_file_'+e.id+'" class="cf'+(e.no_wrap?"":" stnd_padd")+'"><div class="block-item__avatar"><img src="'+S[e.type].thumb+'" alt="" class="preview" id="upload_thumb_'+e.id+'" width="40" height="40"></div><div class="block-item__descr oh"><div><span class="m ico ico_close js-upload_remove right" data-id="'+e.id+'"></span>'+v.fileItemInline(e)+'</div><div><table class="table__wrap table_progress table_progress-full"><tr><td class="table__cell hide" id="upload_spinner_'+e.id+'"></td><td class="table__cell hide" id="upload_err_'+e.id+'"></td><td class="table__cell table__cell_progress hide" id="upload_pb_wrap_'+e.id+'"></td><td class="table__cell"><div class="progress-item__num" id="upload_pb_pct_'+e.id+'"></div></td></tr></table></div></div></div>'},fileItem:function(e){var i;return e.additional_menu?(i=e.name.substr(0,e.name.length-(e.ext.length?e.ext.length+1:0)),'<div class="js-input_error_wrap '+(e.no_wrap?"":"static-bl content-bl__sep")+'" id="upload_file_'+e.id+'"><table class="table__wrap"><tr><td class="block-item__avatar"><img src="'+S[e.type].thumb+'" alt="" class="preview" id="upload_thumb_'+e.id+'" width="80" height="80"><div class="t_center normal-stnd stnd_padd4">'+(e.size?Spaces.getHumanSize(e.size):"")+'</div></td><td style="width: 100%; vertical-align: top"><div class="cl"><div class="text-input__wrap"><input maxlength="50" placeholder="'+(e.name.length?L("Имя файла"):L("Имя файла не определено"))+'" data-id="'+e.id+'" class="text-input js-upl_file_name" type="text" value="'+html_wrap(i)+'" id="upload_name_input_'+e.id+'" '+(e.name.length?"":'readonly="readonly" disabled="disabled"')+' name="filename" /><div class="text-input__control-group"><table height="100%"><tr><td class="m upload-ext js-file_ext no_word_break">.'+html_wrap(e.ext)+'</td><td class="m grey js-file_spinner hide"><span class="ico f__ico_spinner2"></span></td></tr></table></div></div></div><div class="normal-stnd"><div class="js-upload_file_form" data-id="'+e.id+'"></div><div class="cl"><a href="#" class="js-dd_menu_link drop-down-label pad_t_a inline-link" data-menu_id="upload_additional_menu" data-file_id="'+e.id+'" data-position="1" data-noclass="1" data-notogle="1" id="upload_additional_'+e.id+'"><span class="t-padd_right"><span class="ico ico_edit_dim"></span></span>'+L("Редактировать")+'</a></div><div class="cl"><a href="#" class="js-upload_no_pb_ui pad_t_a drop-down-label inline-link js-upload_remove" data-id="'+e.id+'"><span class="t-padd_right"><span class="ico ico_remove"></span></span>'+L("Убрать из загрузки")+'</a><div class="pad_t_a hide js-upload_pb_ui"><table class="table__wrap table_progress table_progress-full"><tr class="m"><td class="table__cell"><div class="t-padd_right js-upload_remove" data-id="'+e.id+'"><span class="ico ico_remove ico_no-mrg"></span></div><div class="t-padd_right js-upload_done hide"><span class="ico ico_ok ico_no-mrg"></span></div></td><td class="table__cell table__cell_progress" id="upload_pb_wrap_'+e.id+'"></td><td class="table__cell"><div class="t-padd_left" id="upload_pb_pct_'+e.id+'"></div></td></tr></table></div><div id="upload_err_'+e.id+'" class="hide pad_t_a"></div></div></div></td></tr></table></div>'):v.fileItemLite(e)},fileItemInline:function(e){return'<span id="upload_file_info_'+e.id+'">'+(e.empty?"":'<span class="ico_files ico_files_'+Spaces.getFileIcon(e.ext)+' js-ico m"></span> ')+html_wrap(e.empty?L("Файл не выбран"):e.name||L("Имя файла не определено"))+"</span> "+(e.size?"<b>("+Spaces.getHumanSize(e.size)+")</b> ":"")+(e.deleteBtn?v.deleteBtn():"")},fileProgress:function(e){return'<div class="progress-item"><div class="progress-item__runner progress-item__runner_light" id="upload_pb_'+e.id+'"></div></div>'},cancelBtn:function(e){return'<input type="submit" value="'+L("Отмена")+'" class="hide js-upload_cancel hide'+("desktop"==Device.type?" url-btn font_medium right":"")+'" /> '},deleteBtn:function(e){return'&nbsp;<span class="m ico ico_close js-upload_remove"></span>'},uploadWidget:function(e){return e.mode==t.MODES.BUTTON?'<div id="upload_main_widget" class="stnd_padd light_border_bottom grey pointer"><div class="stnd_padd break-word">'+v.cancelBtn()+v.uploadBtn(e)+'<span id="upload_main_file" class="hide"></span></div><div id="upload_main_pb" class="hide"></div></div>':'<div id="upload_main_widget"><div class="break-word">'+v.cancelBtn()+v.uploadBtn(e)+'<span id="upload_main_file" class="hide"></span></div><div id="upload_main_pb" class="hide pad_t_a"></div></div>'},uploadBtn:function(e){var i="";return FilesUploader.maybeUnsupported()&&(i='<div class="red">'+L("Скорее всего, ваше устройство не поддерживает выгрузку файлов.")+"</div>"),w?e.mode==t.MODES.WIDGET?'<div class="js-upload_btn_wrap"><span id="upload_file_btn"></span> '+i+"</div>":'<div class="t_center stnd_padd js-upload_btn_wrap"><span id="upload_file_btn"></span> <input type="submit" value="OK" id="upload_submit_btn" />'+i+"</div>":e.mode==t.MODES.WIDGET?i+'<span id="upload_file_btn"><input type="submit" id="upload_file_label" value="'+L("Выберите файл")+'" /></span> ':'<div id="upload_file_btn" class="t_center"><img src="'+ICONS_BASEURL+'icon_add_file.gif" alt="" class="m" /> <small class="m" style="font-weight:bold;">'+L("Загрузить новый файл")+"</small>"+i+"</div>"},spinner:function(e){return'<img src="'+ICONS_BASEURL+'roundPreloader.gif" alt="" class="m upload_spinner" /> '+(e?L("Выгружаем..."):"")},uploadSuccess:function(e){return'<b class="green"><span class="ico ico_ok"></span> '+L("Файл успешно заргружен")+"</b>"},uploadError:function(e){return'<span class="ico ico_alert"></span><small class="red break-word">'+e.message+"</small>"}},b={WIDGET:0,BUTTON:1},l=".spFilesUploader",d={},h=!1,w=FilesUploader.needNtiveControls(),S={};S[Spaces.TYPES.FILE]={name:L("Файлы"),thumb:ICONS_BASEURL+"default_file_preview.png",exts:[],accept:""},S[Spaces.TYPES.PICTURE]={name:L("Фото"),exts:["","gif","jpg","jpeg","png","bmp","webp","3fr","ari","arw","bay","crw","cr2","cap","data","dcs","dcr","dng","drf","eip","erf","fff","iiq","k25","kdc","mdc","mef","mos","mrw","nef","nrw","obm","orf","pef","ptx","pxn","r3d","raf","raw","rwl","rw2","rwz","sr2","srf","srw","tif","x3f"],thumb:ICONS_BASEURL+"transparent.gif",thumb:ICONS_BASEURL+"default_file_preview.png",accept:"image/*"},S[Spaces.TYPES.MUSIC]={name:L("Музыка"),exts:["","mp3","aac","wav","ogg","3ga","wma","flac","m4a","wave","amr","snd","au","aif","aiff","aifc","avi","3gp","3gpp","mpg","mpe","mpeg","wmv","mp4","m4v","flv","mov","webm","asf","mkv","ogv"],thumb:ICONS_BASEURL+"default_file_preview.png",accept:""},S[Spaces.TYPES.VIDEO]={name:L("Видео"),exts:["","avi","3gp","3gpp","mpg","mpe","mpeg","wmv","mp4","m4v","flv","mov","webm","asf","mkv","ogv"],thumb:ICONS_BASEURL+"default_file_preview.png",accept:"ucbrowser"!=Device.browser?"video/*":""},"chrome"==Device.browser&&"desktop"==Device.type&&(S[Spaces.TYPES.VIDEO].accept="."+S[Spaces.TYPES.VIDEO].exts.join(",.")),t=new(Class({MODES:b,Implements:[TSimpleEvents],init:function(e){var i,t,a,r,o,s,p=this;for(i in p.reset(),!1,u=extend({type:Spaces.TYPES.FILE,selectButton:null,buttonClass:{},uploadWidget:null,uploadDrag:null,autoSubmit:!1,noDragClass:!1,mode:b.WIDGET},e))0==i.indexOf("on")&&(t=(t=i.replace(/^on/,""))[0].toLowerCase()+t.substr(1),p.on(t,u[i]),delete u[i]);$("#main").on("click"+l,".js-upload_cancel",function(e){e.preventDefault(),m.cancel()}).on("click"+l,".js-upload_remove",function(e){e.preventDefault();var i=$(this).data("id");$(this).data("type");i!==undefined?(m.remove(i),p.removeTmpFile(i)):m.reset()}),(m=new FilesUploader).setup({autoSubmit:u.autoSubmit}),a=function(e){w?(n.button.show(),n.file.empty(),n.fallback_btn_wrap.show()):(n.label.val(L("Выберите файл")),u.multiple||n.file.html(v.fileItemInline({empty:!0})).show()),n.pb.hide(),n.cancel.hide(),n.button.show(),p._trigger("reset",[!!e]),m.updateButton()},r=function(e,i){o[0].style.width=i+"%",s[0]&&(s[0].innerHTML=Math.round(i)+"%"),w||n.label.val(L("Выгружаем... {0}%",Math.round(i)))},m.on("progress",function(e,i,t,a){r(e,i)}).on("reset",function(){u.multiple||a(!0)}).on("cancel",function(){u.multiple||a(!0)}).on("remove",function(e){u.multiple&&p.removeTmpFile(e.id)}).on("input",function(e){w&&(f.empty(),f.append(e))}).on("limitError",function(){p.error(L("Невозможно добавить файл, вы выбрали максимальное количество файлов. "))}).on("filesChunkStart",function(){p._trigger("filesChunkStart",[])}).on("filesChunkEnd",function(){p._trigger("filesChunkEnd",[])}).on("getTotal",function(){return p._trigger("getTotal",arguments)}).on("afterAutoSubmit",function(){p._trigger("afterAutoSubmit",[])}).on("file",function(e){return _.denyUpload&&0<=$.inArray(e.ext,_.denyUpload.exts)?(u.multiple?(p.addFile(e),p.setFileError(e.id,_.denyUpload.error)):p.error(_.denyUpload.error),!1):(p.error(!1),u.multiple?p.addFile(e):(n.file.html(v.fileItemInline(extend({},e,{deleteBtn:w}))).show(),w&&(n.button.hide(),n.fallback_btn_wrap.hide()),_.mode==b.BUTTON&&n.button.hide(),!0))}).on("preview",function(e,i){$("#upload_thumb_"+e.id).prop("src",i)}).on("submit",function(e){if(!p._trigger("submit",[e]))return!1;p.error(!1),$(u.multiple?"#upload_pb_wrap_"+e.id:"#upload_main_pb").html(v.fileProgress({id:e.id})).show();var i=$("#upload_file_"+e.id);i.find(".js-upload_pb_ui").removeClass("hide"),i.find(".js-upload_no_pb_ui").addClass("hide"),u.multiple||(n.cancel.show(),"desktop"!=Device.type&&n.button.hide(),n.label.val(L("Выгружаем...")),n.file.find("img").replaceWith(v.spinner()),w&&n.wrap.find(".js-upload_remove").hide()),o=$("#upload_pb_"+e.id),s=$("#upload_pb_pct_"+e.id),d.json=1,d.sid=Spaces.sid(),r(e,0),this.setFileParams(e.id,{postData:d})}).on("uploadStart",function(){[],p._trigger("uploadStart")}).on("complete",function(){a(),p._trigger("uploadComplete")}).on("uploaded",function(e,i){var t,a,l,d,n;o.removeClass(g.light),s.addClass(g.pctDone),i.redirect&&!i.data?(m.cancel(),m.on("complete",function(){Spaces.redirect(i.redirect)})):i.redirect_link&&!i.data&&u.multiple?(t=L('Файл заблокирован. <a href="{0}">Узнать подробности</a>',i.redirect_link),u.multiple?p.setFileError(e.id,t):p.error(t)):0!=i.code?(t=Spaces.services.processingCodes(i),u.multiple?p.setFileError(e.id,t):p.error(t)):i.data||i.redirect_link?($("#upload_success_"+e.id).show(),u.removeAfterUpload&&p.removeTmpFile(e.id),i.data&&(Spaces.core.fixFile(i.data,e.extra.spacesType,!0),i.redirect_link&&u.multiple&&($("#upload_file_info_"+e.id).replaceWith(v.fileItemInline({id:e.id,name:i.data.name,ext:i.data.fileext})),(a=$("#upload_file_info_"+e.id)).replaceWith($("<a>").prop("href",i.redirect_link).html(a.html()))),l=$("#upload_thumb_"+e.id),i.data.preview&&i.data.preview.previewURL&&l.prop("src",i.data.preview.previewURL),l.wrap($("<a>",{href:i.redirect_link})),(d=$("#upload_name_input_"+e.id)).length&&!d.val().length&&(d.val(i.data.filename).removeAttr("disabled").removeAttr("readonly"),d.parent().find(".js-file_ext").text(i.data.fileext),p._fixInputWidth(d)),(n=$("#upload_file_"+e.id)).find(".js-upload_remove").addClass("hide"),n.find(".js-upload_done").removeClass("hide")),r(e,100),p._trigger("fileUpload",[i,e])):(t=L('Странная ошибка! Напишите в <a href="/soo/support">Support</a>.'),u.multiple?p.setFileError(e.id,t):p.error(t))}).on("extError",function(e){var i=L("Данный тип файла ({0}) нельзя хранить в разделе <b>{1}</b>",html_wrap(e.ext),S[c].name);u.multiple?p.addFileWithError(e,i):p.error(i)}).on("sizeError",function(e){var i=L("Максимальный размер файла <b>{0}</b>",Spaces.getHumanSize(_.maxSize));_.maxShortVideoSize&&(i=L("Максимальный размер видео до {0} минут <b>{1}</b> и <b>{2}</b> для остальных.",_.maxShortVideoDuration,Spaces.getHumanSize(_.maxShortVideoSize),Spaces.getHumanSize(_.maxSize))),u.multiple?p.addFileWithError(e,i):p.error(i)}).on("notSelectedError",function(){p.error(1<u.maxFiles?L("Файл не выбран!"):L("Файлы не выбраны!"))}).on("error",function(e,i,t,a){var l=t||L("Неизвестная ошибка #{0}",i);u.multiple?p.setFileError(e.id,l):p.error(l),console.error("[upload error]",e,i,t,a)}).on("dragStart",function(){p._trigger("dragStart")}).on("dragDrop",function(){p._trigger("dragDrop")}).on("dragEnd",function(){p._trigger("dragEnd")}).on("dragGlobalStart",function(){p._trigger("dragGlobalStart")}).on("dragGlobalEnd",function(){p._trigger("dragGlobalEnd")}),page_loader.on("shutdown","files_uploader",function(){p.destroy()}),page_loader.one("beforerequest",function(e){if(m.inUpload())return!!confirm(L("Вы уверены, что хотите прервать загрузку файла и перейти на другую страницу?"))&&(m.cancel(),!0)}),h=!0},setup:function(e){var i,t,a,l,d=this;if(!m)throw"Run init() before!";c=e.type||Spaces.TYPES.PICTURE,_=$.extend({maxSize:!1,maxFiles:1,maxShortVideoSize:0,type:Spaces.TYPES.FILE,action:null,denyUpload:null,name:"myFile",inlineFileWidget:!1,selectButton:null,uploadDrag:null,uploadWidget:null,noDragClass:!1,buttonClass:{},mode:b.BUTTON},e),n&&n.widget&&n.widget.remove(),$(_.uploadWidget).replaceWith(i=$(v.uploadWidget({mode:_.mode}))),n={widget:i,wrap:$("#upload_main_widget"),file:$("#upload_main_file"),button:$("#upload_file_btn"),cancel:i.find(".js-upload_cancel"),pb:$("#upload_main_pb"),label:$("#upload_file_label"),fallback_btn_wrap:i.find(".js-upload_btn_wrap")},_.selectButton?(f=$(_.selectButton),w&&(f.click(function(e){e.preventDefault(),e.stopPropagation(),d._trigger("showNative")}),f=$("#upload_file_btn"))):f=$("#upload_file_btn"),$("#upload_submit_btn").click(function(e){e.preventDefault(),tick(function(){m.submit()})}),(t=new Url(_.action)).query.json=1,t.query.domain=location.host,t.query._origin=location.protocol+"//"+location.host,FilesUploader.isAjaxSupport()||(t.query.xhr_iframe=1),a=Math.max(_.maxShortVideoSize,_.maxSize),m.set({action:t.url(),name:_.name,maxSize:a?a+2097152:0,maxFiles:_.maxFiles,postData:{json:1},accept:S[c].accept,allowedExtensions:S[c].exts,extra:{spacesType:_.type}}),m.clearButton(),w||m.setButton(f,_.buttonClass),m.resetDragPlaces().resetPastePlaces(),_.uploadDrag&&(l=$(_.uploadDrag),_.noDragClass||(l.data("dragover-class","dropable-selected"),l.data("dragavail-class","dropable")),l.filesMonitor().on("files",function(e,i){e.stopPropagation(),e.stopImmediatePropagation(),m.addFiles(i.files)}).on("pasteurl",function(e,i){})),_.firstReset&&m.reset()},addFiles:function(e){m.addFiles(e)},loadUrls:function(e){console.log(e)},reset:function(){return m&&m.destroy(),this.off(!1),$("#main").on(l),$("body").off(l),n&&n.widget.remove(),f=n=upload_drag_place=null,h=![],this},destroy:function(){this.reset(),m=_=null},initialized:function(){return h},setPostData:function(e){return d=$.extend({},e),this},addFile:function(e,i){var t,a,l=this,d=$(v.fileItem($.extend({type:_.type},e,{no_wrap:_.inlineFileWidget,additional_menu:_.additionalMenu}))),n=$("#upload_file_form");return n.length&&(d.find(".js-upload_file_form").append(n.text().replace(/x-script/g,"script")),d.find(".js-dd_menu_link").remove()),t={file:e,error:!!i,widget:d},a=l._trigger("newFileAdd",[t]),tick(function(){l._fixInputWidth($("#upload_name_input_"+e.id))}),a},_fixInputWidth:function(e){var i=e.parent(".text-input__wrap"),t=i.find(".text-input__control-group"),a=Math.min(.5*i.width(),t.width()+20);i.css({"padding-right":a+"px"}),e.css({"padding-right":a-11+"px"}),t.find(".js-file_ext").css({"max-width":a-11+"px"})},addFileWithError:function(e,i){return e.error=!0,!!this.addFile(e,!0)&&(this.setFileError(e.id,i),!0)},setFileError:function(e,i){var t,a=this;return $("#upload_err_"+e).html(v.uploadError({message:i})).show(),$("#upload_pb_wrap_"+e+", #upload_additional_"+e+", #upload_spinner_"+e+", #upload_pb_pct_"+e).hide(),a._trigger("fileError",[e,i]),(t=$("#upload_file_"+e)).find(".js-upload_pb_ui").addClass("hide"),t.find(".js-upload_no_pb_ui").removeClass("hide"),t.addClass("js-upload_has_error"),a},showFileSpinner:function(e,i){var t=this,a=$("#upload_name_input_"+e),l=a.parent().find(".js-file_ext"),d=a.parent().find(".js-file_spinner");l.toggle(!i),d.toggle(!!i),t._fixInputWidth(a)},removeTmpFile:function(e){var i=$("#upload_file_"+e);i.length&&(i.remove(),this._trigger("removeFile",[{id:e}]))},error:function(e){return e?(!0,this._trigger("error",[e])):(!1,this._trigger("hideError")),this},submit:function(){return m&&m.submit(),this},getUploader:function(){return m}})),window.FileUploader=t});