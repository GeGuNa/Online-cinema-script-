define("photos_slider","init",function(){function e(){o=$("#photo_preview"),h=$("#photos_slider").data(),page_loader.push("shutdown",t),last_api_req={},L={offset:h.offset-1,total:h.total};var e=o.find(".gview_link:first-child").first();e.length&&(p=Spaces.File.getMeta(e[0]).gid,g=$('<div class="hide">').insertBefore(o),G=$('<div class="hide">').insertAfter(o),GALLERY.unlockGroup(p),GALLERY.setBaseOffset(p,L.offset),GALLERY.setGroupVisibleCount(p,L.total),GALLERY.addPhoto(),GALLERY.onGroup(p,"list",function(e){var t,o;!1===e.last?i(Math.max(L.offset-s/2,0),s+1):0<e.current-e.last?GALLERY.getGroupCnt(p)-e.current<s/4&&(t=G.children().length,i(L.offset+t+1,s)):e.current<s/4&&(o=g.children().length,offset=L.offset-o-s,size=s,offset<0&&(size+=offset,offset=0),i(offset,size))}))}function t(){$.each(last_api_req,function(e,t){Spaces.cancelApi(t)}),last_api_req=o=h=L=null,g=G=null}function i(n,f){var e,t,o,i,s,r,a;if(n+f>L.total&&(f-=n+f-L.total),!(f<=0)&&(l=n,d=f,c=g.children().length,u=G.children().length,l<L.offset-c||l+d>L.offset+u)){var l,d,c,u;if(o=g.children().length,i=G.children().length,t="",e=Math.max(L.offset-n-o,0)){for(s=0;s<e;++s)t+=_.stub(p);g.prepend(t)}if(e&&GALLERY.setBaseOffset(p,L.offset-(o+e)),t="",e=Math.max(n+f-L.offset-i-1,0)){for(s=0;s<e;++s)t+=_.stub(p);G.append(t)}GALLERY.addPhoto(),GALLERY.update(!0),r=function(e){GALLERY.setGroupError(p,e,function(){console.log("retry"),GALLERY.setGroupError(p,e,!1),a()})},(a=function(){var e=$.extend({},h.apiData,{Mode:-1,O:n,L:f});last_api_req[n+":"+f]=Spaces.api("neoapi/files."+e.method,e,function(e){var t,o,i,s;if(delete last_api_req[n+":"+f],0==e.code){for(;e.widgets.length<f;)e.widgets.push(null);for(t=n,o=0;t<n+f;++t,++o)t<L.offset?(i=t-n,s=$(g.children()[i]),e.widgets[o]?s.replaceWith(e.widgets[o]):s.data("notFound",!0)):t>L.offset&&(i=t-L.offset-1,s=$(G.children()[i]),e.widgets[o]?s.replaceWith(e.widgets[o]):s.data("notFound",!0));GALLERY.addPhoto(),GALLERY.update(!0)}else r(Spaces.apiError(e))},{onError:function(e){delete last_api_req[n+":"+f],r(e)}})})()}}var p,o,h,L,g,G,_={stub:function(){return'<div class="gview_link" g="0|0|'+p+'"></div>'}},s=30;define("photos_slider","onRequest",function(){Loader.ready(e)})});