define("search","init",function(){var e,a="usearch"+Date.now(),u={},g=90,h="desktop"==Device.type?150:300,p={suggests:{activeClass:"suggest__item_active",showOnFocus:!0,hideEmpty:!0,inputActiveClass:!1},"default":{activeClass:!1,showOnFocus:!1,hideEmpty:!1,inputActiveClass:!1}},i=Class({Static:{recheck:function(){e||(e=setTimeout(function(){$(function(){e=null,$(".js-usearch_parent").each(function(){i.init($(this))})})},0))},init:function(e){var t,n;return e.data(a)||((t=e.findClass("js-usearch")).length||(t=e.find(".js-usearch_input_wrap .text-input")),t.length||(t=e.find(".js-usearch_input_wrap .js-search__input")),n=t.data("type")||e.data("type"),u[n]&&e.data(a,new i(t))),e.data(a)},register:function(e,t){u[e]=t,this.recheck()}},Constructor:function(e){var t,n,a,i,s,r,l,o,c=this;c.el=e,c.parent=e.findClass("js-usearch_parent"),t=$.extend({selList:".js-usearch_list",selWrap:".js-usearch_list_wrap",selEmpty:".js-usearch_empty"},c.parent.data(),e.data()),c.cfg=$.extend({length:0},u[t.type],{apiMethod:t.apiMethod,apiData:t.apiData}),c.type=t.type,c.list=c.parent.find(c.cfg.selList||t.selList),c.wrap=c.parent.find(c.cfg.selWrap||t.selWrap),c.empty=c.parent.find(c.cfg.selEmpty||t.selEmpty),c.wrap.length||(c.wrap=c.list),"object"==typeof c.cfg.render?c.render=$.extend(p[t.type||"default"],c.cfg.render):"string"==typeof c.cfg.render&&(c.render=p[t.render||c.cfg.render||"default"]),c.render="object"==typeof c.cfg.render?c.cfg.render:p[c.cfg.render||"default"],n=function(e,t){var n,a=$.trim(c.el.val());r||(r=i!=a),i=a,r&&c.cancelApi(),n=!a.length||a.length<c.cfg.length,r&&c.cfg.onInput&&c.cfg.onInput({value:a,empty:n}),!e&&Date.now()-s<=g||(c.valueEmpty=n,c.value=a,(r||t)&&(c.search(a,t),i=a,r=!1))},c.list.on("click",".js-usearch_result_val",function(e){e.preventDefault();var t=$(this);c.el.val(t.data("value")).trigger("change").trigger("usearch:change",{item:t}),t.data("hide")&&t.trigger("closeSearch")}),i=c.cfg.skipDefault?$.trim(c.el.val()):"",s=0,o=!(r=!1),c.focused=!1,e.on("focus",function(){c.focused=!0,a&&clearInterval(a),o&&(n(!0),o=!1),a=setInterval(n,h),c.toggleList(),l=null}).on("blur",function(){c.focused=!1,clearInterval(a),n(!0),a=null,l&&Date.now()-l.time<100&&$(l.el).click(),c.render.showOnFocus&&c.showList(!1),l=null}).on("input",function(){a?(n(),s=Date.now()):n(!0)}).on("keydown",function(e){!c.cfg.enter||e.keyCode!=Spaces.KEYS.ENTER&&e.keyCode!=Spaces.KEYS.MAC_ENTER?e.keyCode==Spaces.KEYS.ESC?c.render.showOnFocus&&c.showList(!1):e.keyCode!=Spaces.KEYS.UP&&e.keyCode!=Spaces.KEYS.DOWN||c.toggleList():(e.preventDefault(),n(!0))}),c.parent.on("clearSearchForm",function(){n(!0),c.el.trigger("usearch:change",{item:!1})}).on("closeSearch",function(){c.cfg.hideEmpty&&(c.list.html(""),c.toggleList())}).on("click",".js-search__submit",function(e){e.preventDefault(),n(!0),c.el.focus()}),c._valueMonitor=n,c.render.activeClass&&c.list.length&&(c.list.itemsSelector({activeClass:c.render.activeClass,keydownArea:c.el}),c.list.on("click",">*",function(e){e.preventDefault()}),c.list.on("highlight",">*",function(){l={el:this,time:Date.now()}})),c.el.is(":focus")&&c.el.blur().focus()},search:function(n,a){var e,t,i=this,s=i.cfg;if(i.cancelApi(),s.hideEmpty&&i.valueEmpty)return i.list.html(""),void i.toggleList();if(!(i.cfg.length&&i.cfg.length>n.length)||i.cfg.allowEmpty&&!n.length){if(e=$.extend({},s.apiData),t="function"==typeof s.apiMethod?s.apiMethod.call(i,[]):s.apiMethod,s.onBeforeSend&&s.onBeforeSend.call(i,n,e),e[s.param]=n,s.doSearch)return i.toggleLoading(!0),void(i.last_api_request=s.doSearch({query:n,refresh:a,method:t,api_data:e,onSuccess:function(){i.toggleLoading(!1)},onError:function(e){i.toggleLoading(!1),Spaces.showError(e)},list:i.list}));i.toggleLoading(!0),i.last_api_request=Spaces.api(t,e,function(e){if(i.toggleLoading(!1),s.noapi||0==e.code){if(s.onResult&&s.onResult.call(i,e,n),s.onRender)s.onRender.call(i,i.list,e,n);else{var t=e[s.results];t.join&&(t=t.join("")),i.list.html(t)}a&&i.render.showOnFocus&&!i.focused||i.toggleList()}else Spaces.showApiError(e)},{retry:10,onError:function(e){i.toggleLoading(!1),Spaces.showError(e)}})}},cancelApi:function(){Spaces.cancelApi(this.last_api_request),this.parent.removeClass("search__loading")},toggleLoading:function(e){this.parent.toggleClass("search__loading",e)},showList:function(e){var t=this;t.list.length&&(t.wrap.toggle(!!e),t.render.inputActiveClass&&t.el.parent().toggleClass(t.render.inputActiveClass,!!e),Spaces.fixHeight(t.wrap))},toggleList:function(){var e,t=this;t.list.length&&(e=!t.list.children().length,t.cfg.onToggleList&&t.cfg.onToggleList({listEmpty:e,valueEmpty:t.valueEmpty}),t.render.showOnFocus||!t.empty.length?(Spaces.fixHeight(t.wrap),t.showList(!e)):e?(t.empty.show(),t.list.hide()):(t.empty.hide(),t.list.show()))},refreshSearch:function(){this._valueMonitor(!0,!0)}});window.UniversalSearch=i,$.fn.usearch=function(e){var t,n=this.first();return e&&(t="usearch_"+Date.now(),u[t]=e,n.data("type",t)),i.init(n)},define("search","onRequire",function(){i.recheck()})});