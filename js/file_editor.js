define("file_editor","init",function(){function e(e){if(!("operamobile"==Device.browser&&Device.v<=12)){var r=$("form").on("text_save","textarea, input",function(e,i){t[this.name]&&f(r)&&function n(r){var o,e,t;if(s)return void(c=!0);s=!0;o={filename:"new_filename",name:"new_name"};e=$.extend({Type:r.data("fileType")||25},Url.serializeForm(r));a(!1);Spaces.clearError("file_edit");t=function(){if(s=!1,c&&(c=!1,f(r)))return n(r),!0};Spaces.api("neoapi/files.edit",e,function(e){if(!t())if(0!=e.code&&e.code!=Codes.FILES.ERR_EDIT)Spaces.showApiError(e,"file_edit",{onRetry:function(){n(r)}});else{if(e.code==Codes.FILES.ERR_EDIT)for(var i in o)e.errors[i]&&Spaces.view.setInputError(r.find('[name="'+o[i]+'"]'),e.errors[i]);a(!0),$(".js-file_spinner").addClass("hide")}},{onError:function(e){t()||Spaces.showError(e,"file_edit",{onRetry:function(){n(r)}})}})}(r)}).on("xxx_cats:saving",function(e,i){a(i.saved)});f(r)}}function a(e){var i=$('button[name="cfms"]').toggleClass("disabled",!e);i.find(".js-ico").toggleClass("ico_spinner",!e),i.find(".js-btn_val").text(e?L("Готово"):L("Сохранение"))}function f(e){var i,n=Url.serializeForm(e),r=0;for(i in t)""+n[i]!=o[i]&&(i in o&&$("#file_spinner__"+i).removeClass("hide"),o[i]=n[i]+"",++r);return 0<r}var o={},t={new_name:1,new_filename:1},s=!1,c=!1;define("file_editor","onRequest",function(){$(e)})});