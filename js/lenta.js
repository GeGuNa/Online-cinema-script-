define("lenta","onRequest",function(){var p="js-link_clicked",d="link_active",s="item_clicked",n={loading:"ico f__ico_spinner2"};$("#main").on("click",".js-more_items_link_wrapper",function(e){e.preventDefault();var o=$(this),a=o.find("a"),l=o.data("id"),t=o.data("offset"),i=$("#l_"+l);a.hasClass(s)||(a.addClass(s).find(".ico").prop("className",n.loading),Spaces.api("neoapi/lenta.getItems",{Oid:l,O:t,Short:i.data("short")},function(e){var a,t,i,s,n;if(o.hide(),0!=e.code)Spaces.showApiError(e);else{if(0<e.items.list.length){for(t=(a=e.items.list).length,i="",s=0;s<t;s++)i+='<div class="lenta-block__item">'+a[s]+"</div>";$("#l_"+l+"-items").append(i)}0<e.items.tile.length&&((n=$("#l_"+l+"-tile_items")).append(e.items.tile.join("")),n.append(n.find(".tiled_cap").detach()),console.log("???")),GALLERY.addPhoto()}}))}).on("click",".js-delete_lenta_item a",function(e){var a,t,i,s,n,o,l,d,r,c;e.preventDefault(),a=$(this),i=(t=a.parent()).data("id"),n=(s=new Url(location.href).query).P||1,o=+t.data("cancel"),l=$("#js-lenta_events_wrapper"),d=l.data("items_on_page"),r=$("#l_"+i),a.data("busy")||((c=function(e){o?a.find(".ico").toggleClass("ico_spinner",e):a.toggleClass("ico_spinner",e),a.data("busy",e)})(!0),Spaces.api("neoapi/lenta.objectDelete",{Oid:i,CK:null,Pag:1,Ol:!o,L:1,O:n*d-1,At:s.At||0,Aid:s.Aid||0,P:n,Sort:t.data("sort")||s.Sort||0,Cancel:o,Rli:t.data("rli"),Short:r.data("short")},function(e){if(c(!1),0!=e.code)Spaces.showApiError(e);else{o||$(".js-restore_lenta_item_menu:visible").remove(),r.replaceWith(e.widget),o&&$(".content-usr:nth-child("+(d+1)+")").remove(),e.objects&&l.append(e.objects.join(""));var a=e.pagination&&"undef"!=e.pagination?e.pagination:"";$("#js-lenta_pagination_wrapper .js-pag_item").each(function(){var e=$(this);e.hasClass("hide")?(e.removeClass("hide"),o||e.html(a)):e.addClass("hide")})}t.removeClass(p)},{onError:function(e){c(!1),Spaces.showError(e)}}))}).on("click",".js-get_settings_form a",function(e){var a,t,i,s,n,o,l;e.preventDefault(),a=$(this),i=(t=a.parent()).data("id"),s=$("#l_"+i+"-user_settings"),a.hasClass(p)?(a.removeClass(p+" "+d),s.hide()):(a.addClass(p+" "+d),"1"!=t.data("form_loaded")&&(n=a.parents(".js-link_id").data("link_id"),o=t.data("author_id"),l=t.data("author_type"),Spaces.api("neoapi/lenta.getSettingsForm",{Aid:o,At:l,Link_id:n,CK:null},function(e){0!=e.code?Spaces.showApiError(e):(s.html(e.form),t.data("form_loaded","1"))})),s.show())}).on("click",".js-close_settings_form a",function(e){e.preventDefault();var a=$(this).parents(".widgets-group").data("id");$("#l_"+a+"-user_settings").hide(),$("#l_"+a+"-get_settings_form a").removeClass(p+" "+d)}).on("click",".js-show_last_comments",function(e){e.preventDefault();var i=$(this),a=(i.find(".ico_abar").get(0).className="ico f__ico_spinner2",i.data("ot")),s=i.data("id");1!=i.data("clicked")&&(i.addClass("item_clicked").data("clicked",1),Spaces.api("neoapi/comments.readLast",{Ot:a,Oid:s,from:"mylenta",Link_id:$("#js-lenta_events_wrapper").data("link_id")},function(e){var a,t;i.hide(),a=$("#last_comments_"+s),0!=e.code?(t=Spaces.apiError(e),e.code==Codes.COMMON.ERR_FORBIDDEN&&(t=L("Доступ к записи закрыт.")),t='<div class="system-message system-message_alert">'+t+"</div>",a.html(t).removeClass("hide")):(a.fastHtml(e.comments).removeClass("hide"),i.parents("#lenta > div").append(a),require("gallery",function(){GALLERY.addPhoto()}))}))}).action("author_block",function(e){e.preventDefault();var a=$(this),t=a.parents(".js-replace_widget");t.parent().find(".js-replace_link").remove(),t.remove(),Spaces.api("neoapi/lenta.authorBlock",{Aid:a.data("aid"),At:a.data("at"),CK:null},function(e){0!=e.code&&Spaces.showApiError(e)})})});