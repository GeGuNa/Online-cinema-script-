define("rightbar","init",function(){var o,n,i,s,d,e,t,r=6e4;window.pushstream&&define("rightbar","onRequire",function(){$(function(){o&&o.destroy(),Spaces.cancelApi(t),pushstream.off("message","rightbar"),page_loader.off("shutdown","banner_rotator"),page_loader.off("pageloaded","rightbar"),page_loader.off("pageloaded","widgets_rotator"),$("#journal_right_bar").off(),n=$("#journal_right_bar"),i=$("#journal_right_bar_empty"),widget=n.parents(".js-container__block"),s=n.data("onPage"),d=n.parents(".js-container__block").first().find(".js-cnt"),e=$(".js-banner_rotator"),o=new Spaces.MsgFlowControl({interval:r,focus:!0,onRefresh:function(r){return Spaces.api("neoapi/journal.getUnreadRecordsWidgetsByOL",{O:0,L:s,Link_id:Spaces.params.link_id},function(e){0==e.code?(r.done(),widget.toggleClass("hide",!e.widgets.length),n.toggleClass("hide",!e.widgets.length),i.toggleClass("hide",0<e.widgets.length),n.html(e.widgets.join("")),d.text(e.count).toggleClass("hide",!e.count)):(console.error("[journal] "+Spaces.apiError(e)),r.fail())},{retry:10,onError:function(e){console.error("[journal] "+e),r.fail()}})},onRequest:function(o){var t=o.queue;Spaces.api("neoapi/journal.getRecordsWidgetsByIds",{RiDs:t,Link_id:Spaces.params.link_id},function(e){var r,a;if(0==e.code){for(o.done(),t.sort(),r=0;r<t.length;++r)$("#rightbar_j"+t[r]).remove(),e.widgets[t[r]]&&n.prepend(e.widgets[t[r]]);for(widget.removeClass("hide"),n.removeClass("hide"),i.addClass("hide"),a=n.children(),r=s;r<a.length;++r)$(a[r]).remove();d.text(+d.text()+1).removeClass("hide")}else console.error("[journal] "+Spaces.apiError(e)),o.fail()},{retry:10,onError:function(){console.error("[journal] "+err),o.fail()}})}}),e.length&&page_loader.on("shutdown","banner_rotator",function(){e.each(function(){var e=$(this),r=e.data("current")+1;r>=e.data("cnt")&&(r=0),e.prop("src",e.data("url").replace("{n}",r)).data("current",r)})},!0),pushstream.on("message","rightbar",function(e){var r,a;if(!(Spaces.notifications&&Spaces.notifications.needIgnore(e)||(e.act==Spaces.LongPollingTypes.UOBJ_RECOMMENDATIONS_UPDATE&&(Spaces.cancelApi(t),t=Spaces.api("neoapi/uobj_recomm.getRightBarWidget",{Link_id:Spaces.params.link_id},function(e){0==e.code&&$("#rightbar_recomm").replaceWith(e.widget)})),e.act!=Spaces.LongPollingTypes.TOP_COUNTER_UPDATE))){if(e.clean&&(n.empty(),d.val(0).addClass("hide"),widget.addClass("hide"),n.addClass("hide"),i.removeClass("hide")),e.deletedRecordsIds){for(a=r=0;a<e.deletedRecordsIds.length;++a)$("#rightbar_j"+e.deletedRecordsIds[a]).length&&++r;r&&o.refresh()}e.recordsIds&&o.get(e.recordsIds)}}),tick(function(){page_loader.on("pageloaded","widgets_rotator",function(){var e,r=$("#rightbar_sames");r&&(r.remove(),$("#rightbar_recomm").removeClass("hide"),(e=$("."+Spaces.params.ac+"2")).next("div").length||e.prev().before(e))},!1)}),$("#journal_right_bar").on("click",".list-link",function(){window.pushstream&&pushstream.avail()||page_loader.on("pageloaded","rightbar",function(){o.refresh()})})})})});