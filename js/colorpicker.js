define("colorpicker","init",function(){function o(e){function t(r,e,t,o){var c=function(r,e,t){var o,c,a=Math.max(r/=255,e/=255,t/=255),i=Math.min(r,e,t),n=a,s=a-i;if(c=0==a?0:s/a,a==i)o=0;else{switch(a){case r:o=(e-t)/s+(e<t?6:0);break;case e:o=(t-r)/s+2;break;case t:o=(r-e)/s+4}o/=6}return[o,c,n]}(r,e,t);a(c[0],c[1],c[2],o)}function a(r,e,t,o){var c,a;v[0].style.top=100*(1-r)+"%",u[0].style.top=100*(1-t)+"%",u[0].style.left=100*e+"%",r!==n&&(c=h(r,1,1),d.css("background","#"+m(c[0])+m(c[1])+m(c[2]))),n=r,s=e,l=t,a=i(),o||f.val(a),p.css("background",a),Spaces.LocalStorage.set("colopicker:last",a)}function i(){var r=h(n,s,l);return"#"+m(r[0])+m(r[1])+m(r[2])}e.empty().append(r.colorpicker());var n,s,l,o=e.find(".colorpicker-spectrum"),d=e.find(".colorpicker-rect"),p=e.find(".colorpicker-color"),u=e.find(".colorpicker-gradient_cursor"),v=e.find(".colorpicker-spectrum_cursor"),f=e.find("input"),c=e.find(".js-cc_paste"),k=this;$.extend(k,{setRGB:t,setColor:function(r){var e=g(r);e&&t(e[0],e[1],e[2])},color:i,destroy:function(){e.removeData(b).empty(),o=d=p=u=v=f=c=null}}),function(){o.draggable({fastEvents:!0,relative:!0,disableContextMenu:!1,forceStart:!0,forceMove:!0,scroll:!0,events:{dragMove:function(r){a(1-Math.min(1,Math.max(r.rpH,0)),s,l)}}}),d.draggable({fastEvents:!0,relative:!0,disableContextMenu:!1,forceStart:!0,forceMove:!0,scroll:!0,events:{dragMove:function(r){a(n,Math.min(1,Math.max(r.rpW,0)),1-Math.min(1,Math.max(r.rpH,0)))}}}),f.on("input",function(){var r=g(f.val());f.toggleClass("text-input_error",!r),r&&t(r[0],r[1],r[2],!0)}),c.click(function(r){r.preventDefault(),e.trigger("colorpicker:select",{color:i()}),console.log(i())});var r=Spaces.LocalStorage.get("colopicker:last");k.setColor(r||"#395387")}()}function m(r){return pad(r.toString(16).toUpperCase(),2)}function g(r){var e,t,o,c=r.match(/([a-f0-9]+)/i);if(!c)return null;if(6==(c=c[1]).length)e=parseInt(c.substr(0,2),16),t=parseInt(c.substr(2,2),16),o=parseInt(c.substr(4,2),16);else{if(3!=c.length)return null;e=parseInt(c[0]+c[0],16),t=parseInt(c[1]+c[1],16),o=parseInt(c[2]+c[2],16)}return[e,t,o]}function h(r,e,t){var o,c,a,i=Math.floor(6*r),n=6*r-i,s=t*(1-e),l=t*(1-n*e),d=t*(1-(1-n)*e);switch(i%6){case 0:o=t,c=d,a=s;break;case 1:o=l,c=t,a=s;break;case 2:o=s,c=t,a=d;break;case 3:o=s,c=l,a=t;break;case 4:o=d,c=s,a=t;break;case 5:o=t,c=s,a=l}return[Math.round(255*o),Math.round(255*c),Math.round(255*a)]}var r={colorpicker:function(){return'<div class="colorpicker"><table><tr><td><div class="colorpicker-rect"><div><div class="colorpicker-gradient_cursor"></div></div></div></td><td><div class="colorpicker-spectrum"><div class="colorpicker-spectrum_cursor"></div></td><td style="max-width: 138px" class="colorpicker-big">'+r.form()+'</td></tr></table><div class="colorpicker-small">'+r.form()+"</div></div>"},form:function(){return'<div class="normal-stnd">'+("desktop"==Device.type?L("Выбранный цвет:"):L("Ваш цвет:"))+'</div><div class="colorpicker-row"><div class="colorpicker-color"></div></div><div class="colorpicker-row"><div class="text-input__wrap colorpicker-pad"><input type="text" class="text-input" autocomplete="off" name="color" value="" maxlength="64" /></div></div><div class="colorpicker-row"><div class="btn-main perimeter-border js-cc_paste">'+L("Вставить")+"</div></div>"}},b="SSCC"+Date.now();$.fn.colorpicker=function(r){var e,t=this.first();return t.length?(e=t.data(b),!1===r?(e&&e.destroy(),e=null):e||t.data(b,e=new o(t)),e):null}});