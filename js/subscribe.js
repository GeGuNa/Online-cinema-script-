define("subscribe","init",function(){if(Spaces.params.nid){var _=$("body");_.on("click",".js-friend_request",function(a){a.preventDefault(),a.stopPropagation();var e=$(this),i=e.data("user"),r=e.data("contact"),t=e.data("mode"),n=$("#js-request_message_"+t),o=$("#js-request_message_error_"+t),s=$.trim(n.val()),d=e.data("in_pendings"),c=e.data("rec_tile"),l=e.data("noclick"),p=e.data("list_item");e.data("error")||(100<s.length?(n.addClass("text-input_error"),o.addClass(L("pad_t_a")).text(L("Длина сообщения не должна превышать 100 символов."))):Spaces.api("friends.offer",{user:i,Contact:r,message:s,CK:null},function(t){var a,s;t.code==Codes.COMMON.SUCCESS?(1==c||2==p?((a=e.parents(".js-pending-item")).find(".js-add-friend, .js-remove-pending").hide(),t.offer_accepted?a.find(".not_friends_link").show():a.find(".friends_link_requested").show()):(s=!1,$("div[data-cuser="+i+"], div[data-ccontact="+r+"]").each(function(){var a,e=$(this);e.prop("className").indexOf("js-friends_")<0&&e.prop("className").indexOf("js-lenta_subscr_")<0||(t.offer_accepted?(e.hasClass("js-friends_delete")||e.hasClass("js-lenta_subscr_delete")?e.show():e.hide(),1==d&&(s||(s=!0,Spaces.notifications.showNotification(L("Предложение дружбы принято."),"info")),a=$("#pendings_cnt"),0==t.pendings_cnt?a.hide():a.html(t.pendings_cnt),e.parent().addClass("table__cell_last").attr("width","100%").next(".table__cell").remove())):0<=e.prop("className").indexOf("js-friends_")&&(e.hasClass("js-friends_revoke")?e.show():e.hide()))})),(1!=l||1!=d&&1!=p)&&_.trigger("click"),1!=d&&1!=p&&(n.val("").removeClass("text-input_error"),o.removeClass("pad_t_a").text(""))):Spaces.showApiError(t)},{prefix:"neoapi"}))}),_.on("click",".js-lenta_subscr_add a[data-action=lenta_subscr_add]",function(a){a.preventDefault(),a.stopPropagation();var e=$(this),t=e.parent(),s=t.data("author_id"),i=(t.data("rand"),t.data("author_type"));e.data("error")||e.hasClass("js-dd_menu_link")||Spaces.api("lenta.authorAdd",{Aid:s,At:i,CK:null},function(a){a.code==Codes.COMMON.SUCCESS?$("div[data-author_type="+i+"][data-author_id="+s+"]").each(function(){var a=$(this);a.hasClass("js-lenta_subscr_as")?a.hide():a.show()}):Spaces.showApiError(a)},{prefix:"neoapi"})}),_.on("click","a[data-action=lenta_subscr_remove]",function(a){a.preventDefault(),a.stopPropagation();var e=$(this),t=e.parent(),s=t.data("author_id"),i=(t.data("rand"),t.data("author_type"));e.data("error")||e.hasClass("js-dd_menu_link")||Spaces.api("lenta.authorDelete",{Aid:s,At:i,CK:null},function(a){a.code==Codes.COMMON.SUCCESS?($("div[data-author_type="+i+"][data-author_id="+s+"]").each(function(){var a=$(this);a.hasClass("js-lenta_subscr_as")?a.show():a.hide()}),_.trigger("click")):Spaces.showApiError(a)},{prefix:"neoapi"})}),_.on("click",".js-remove-friend",function(a){a.preventDefault(),a.stopPropagation();var e=$(this),t=e.data("user"),s=e.data("contact"),i=e.data("noclick"),r=(e.data("in_pendings"),e.data("list_item"));e.data("error")||Spaces.api("friends.delete",{user:t,Contact:s,CK:null},function(a){0==a.code?($("div[data-cuser="+t+"], div[data-ccontact="+s+"]").each(function(){var a=$(this),e=this.className.match(/js-(lenta|friends).*?(add|delete|revoke)/i);a.toggle("add"==e[2])}),1!=i&&1!=r&&_.trigger("click")):Spaces.showApiError(a)},{prefix:"neoapi"})}),_.on("click",".js-cancel-friend-request",function(a){a.preventDefault(),a.stopPropagation();var e=$(this),t=e.data("user"),s=e.data("noclick");e.data("in_pendings"),e.data("rec_tile"),e.data("list_item");e.data("error")||Spaces.api("friends.revokeOffer",{user:t,CK:null},function(a){a.code==Codes.COMMON.SUCCESS?($("div[data-cuser="+t+"]").each(function(){var a=$(this),e=this.className.match(/js-friends.*?(add|delete|revoke)/i);e&&a.toggle("add"==e[1])}),1!=s&&_.trigger("click")):Spaces.showApiError(a)},{prefix:"neoapi"})}),_.on("click",".js-complaint_link",function(a){a.preventDefault(),a.stopPropagation();var t=$(this),e=t.data("object_id"),s=t.data("type"),i=t.data("mode"),r=$("#js-complaint_message_"+i),n=$("#js-complaint_message_error_"+i),o=$.trim(r.val()),d=$(".js-radio-complaint_reason input[type=radio]:checked").val()||"",c=t.data("disabled");t.data("error")||"1"==c||(1e3<o.length?(r.addClass("text-input_error"),n.addClass("pad_t_a").text(L("Длина сообщения не должна превышать 1000 символов."))):Spaces.api("complaints.complain",{Oid:e,c:o,T:s,R:d,CK:null},function(a){if(a.code==Codes.COMMON.SUCCESS){_.trigger("click"),r.val("").removeClass("text-input_error"),n.removeClass("pad_t_a").text("");var e=t.parents(".js-dd_menu_item").attr("id");$("a[data-menu_id="+e+"] .ico").get(0).className="ico ico_ok_green",Spaces.notifications.showNotification(L("Спасибо! Ваша жалоба будет рассмотрена в ближайшее время."),"info")}else Spaces.showApiError(a)},{prefix:"neoapi"}))}),_.on("click",".js-radio-complaint_reason",function(a){$(".js-complaint_link").removeClass("user__tools-link_disabled").data({disabled:0}).find(".ico_ok_grey").removeClass("ico_ok_grey").addClass("ico_ok_blue")})}});